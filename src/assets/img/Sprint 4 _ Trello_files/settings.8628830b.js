function e(e,t,r,s){Object.defineProperty(e,t,{get:r,set:s,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},i={},n=r.parcelRequired932;null==n&&((n=function(e){if(e in s)return s[e].exports;if(e in i){var t=i[e];delete i[e];var r={id:e,exports:{}};return s[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){i[e]=t},r.parcelRequired932=n),n.register("9kS2s",(function(t,r){e(t.exports,"sendUIEvent",(()=>f));var s=n("19ezt"),i=n("9moZQ"),o=n("6UCH9");const a=["slackTrelloPowerUp"],c=window.navigator.userAgent.includes("TrelloDesktop");const{env:u,apiHost:l}=function(){switch(o.environment){case"production":return{env:s.envType.PROD,apiHost:"api-gateway.trello.com/gateway/api/gasv3/api/v1"};case"staging":return{env:s.envType.STAGING,apiHost:"api-gateway.trellis.coffee/gateway/api/gasv3/api/v1"};case"local":return{env:s.envType.LOCAL,apiHost:"api-gateway.trellis.coffee/gateway/api/gasv3/api/v1"};default:throw new Error(`Unknown environment ${o.environment}`)}}(),d=new(0,i.default)({env:u,product:"trello",version:o.version,origin:c?s.originType.DESKTOP:s.originType.WEB,platform:c?function(){const{platform:e}=window.navigator;if(e)return e.includes("Win")?s.platformType.WINDOWS:e.includes("Linux")?s.platformType.LINUX:e.includes("Mac")?s.platformType.MAC:void 0}():s.platformType.WEB,locale:window.navigator.language},{apiHost:l});d.setTenantInfo(s.tenantType.NONE);let h=!1;function p(e,t,r){try{!function(e){if(h)return;const t=e.getContext().member;d.setUserInfo(s.userType.TRELLO,t),h=!0}(t);const i=function(e){const t=e.getContext();return["card","board","organization","enterprise"].reduce(((e,r)=>t[r]?{...e,[r]:{id:t[r]}}:e),{})}(t);r({...e,containers:i,tags:a})}catch(e){console.warn("Failed to send analytic event",e)}}function f(e,t){p(e,t,d.sendUIEvent)}})),n.register("9moZQ",(function(r,s){e(r.exports,"default",(()=>D));var i=n("8ymt6"),o=n("fWyjG"),a=n("19ezt"),c=n("aALk9"),u=n("dZAxt"),l=n("5T591"),d=n("7ndiM"),h=n("kWYz4"),p=n("6gXvm"),f=n("Dn6LR"),m=n("gqScn"),g=n("jsIfO"),y=n("gTWwa"),v=n("lTBkD"),b=n("7A4TJ"),E=n("lIOOf"),I=n("5V0ZZ"),w=n("g4FZb"),O=n("iRYxa"),T=n("k4ZbT");function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function S(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?_(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):_(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const A="last.screen.event";class D{constructor(e,r={}){if(t(i)(this,"_useStargate",(e=>null==e||e)),t(i)(this,"_selectHost",(({useStargate:e,env:t,useLegacyUrl:r})=>e?r?t===a.envType.PROD?"api-private.atlassian.com/gasv3/api/v1":"api-private.stg.atlassian.com/gasv3/api/v1":window.location.host+"/gateway/api/gasv3/api/v1":t===a.envType.PROD?"as.atlassian.com/api/v1":"as.staging.atl-paas.net/api/v1")),t(i)(this,"_endsWith",((e,t)=>-1!==e.indexOf(t,e.length-t.length))),t(i)(this,"_changeInternalUserId",((e,t)=>{this.eventProcessor.getUser().setUserId(e),t&&t!==this.eventProcessor.getUser().getAnonymousId()&&this.eventProcessor.getUser().setAnonymousId(t)})),t(i)(this,"_createSubproductGetter",(e=>(0,u.default)(e,"Cannot get subproduct from the callback. Proceeding without it."))),t(i)(this,"_createEmbeddedProductGetter",(e=>(0,u.default)(e,"Cannot get embeddedProduct from the callback. Proceeding without it."))),t(i)(this,"_getLastScreenEvent",(()=>{try{return JSON.parse(this._safeSessionStorage.getItem(A)||"")}catch(e){return this._safeSessionStorage.removeItem(A),null}})),t(i)(this,"_setLastScreenEvent",(e=>{this._safeSessionStorage.setItem(A,JSON.stringify({name:e.name,attributes:e.attributes}))})),t(i)(this,"_shouldEventBeDelayed",(e=>{if(!e.tags||-1===e.tags.indexOf("measurement"))return!1;const t=!1!==e.highPriority;return this.eventDelayQueue.isDelayingLowPriorityEvents()&&!t})),t(i)(this,"_fireEvent",((e,t,r,s)=>{switch(t.eventType){case a.eventType.UI:case a.eventType.OPERATIONAL:case a.eventType.TRACK:return this.eventProcessor.track(e,t,r,s);case a.eventType.SCREEN:return this.eventProcessor.page(e,t,r,s);case a.eventType.IDENTIFY:return this.eventProcessor.identify(e,t,r,s);default:throw new Error(`No handler has been defined for events of type ${t.eventType}`)}})),t(i)(this,"_fireDelayedEvent",((e,t,r,s)=>{try{this._changeInternalUserId(s.userId,s.anonymousId),t.tags=[...t.tags||[],"sentWithDelay"],this._fireEvent(e,t,r,void 0)}finally{this._changeInternalUserId(this._userInfo.userId,this._userInfo.anonymousId)}})),t(i)(this,"_delayEvent",((e,t,r,s,i)=>{this.eventDelayQueue.push(e,t,r,s),i&&i()})),t(i)(this,"_processEvent",((e,t,r,s)=>(this._testingCache.saveEvent(t),this._shouldEventBeDelayed(t)?(this._delayEvent(e,t,r,this._userInfo,s),Promise.resolve()):this._fireEvent(e,t,r,s)))),t(i)(this,"setEmbeddedProduct",(e=>{this._productInfo.embeddedProduct=this._createEmbeddedProductGetter(e),this.resetUIViewedTimers()})),t(i)(this,"clearEmbeddedProduct",(()=>{this._productInfo.embeddedProduct=this._createEmbeddedProductGetter(null)})),t(i)(this,"setSubproduct",(e=>{this._productInfo.subproduct=this._createSubproductGetter(e),this.resetUIViewedTimers()})),t(i)(this,"setOriginTracingHandlers",(e=>{const t=this.originTracing.handleOriginParameters(e,this._historyReplaceFn);Object.keys(t).forEach((e=>{void 0!==t[e].taskSessionId&&this.task.createTaskSessionWithProvidedId(e,t[e].taskSessionId)}));const r={};return Object.keys(t).forEach((e=>{t[e].originTracingAttributes?r[e]=t[e].originTracingAttributes:console.warn(`Handling method for origin parameter ${e} has not returned any attributes`)})),Object.keys(t).length>0?this.sendOperationalEvent({action:"landed",actionSubject:"origin",source:"webClient",attributes:{originTracesLanded:r}},(()=>{})):Promise.resolve()})),t(i)(this,"setTenantInfo",((e,t)=>{if(!e)throw new Error("Missing tenantIdType");if(e!==a.tenantType.NONE&&!t)throw new Error("Missing tenantId");if(!(0,a.isType)(a.tenantType,e))throw new Error(`Invalid tenantIdType '${e}', must be an tenantType: [${(0,a.objectValues)(a.tenantType)}]`);this._tenantInfo={tenantIdType:e,tenantId:t}})),t(i)(this,"clearTenantInfo",(()=>{this._tenantInfo={}})),t(i)(this,"setOrgInfo",(e=>{if(!e)throw new Error("Missing orgId");this._orgInfo={orgId:e}})),t(i)(this,"clearOrgInfo",(()=>{this._orgInfo={}})),t(i)(this,"setUserInfo",((e,t)=>{(0,h.validateIdentifyEvent)(e,t),this._changeInternalUserId(t),this._userInfo={userIdType:e,userId:t,anonymousId:this.eventProcessor.getUser().getAnonymousId()}})),t(i)(this,"clearUserInfo",(()=>{this._changeInternalUserId(void 0),this._userInfo={anonymousId:this.eventProcessor.getUser().getAnonymousId()}})),t(i)(this,"getAnonymousId",(()=>this._userInfo.anonymousId)),t(i)(this,"setUIViewedAttributes",(e=>{if(!e)throw new Error("Missing uiViewedAttributes");if("object"!=typeof e||Array.isArray(e))throw new Error("Invalid uiViewedAttributes type, should be a non array object");this._uiViewedAttributes=S({},e)})),t(i)(this,"getUIViewedAttributes",(()=>this._uiViewedAttributes)),t(i)(this,"clearUIViewedAttributes",(()=>{this._uiViewedAttributes={}})),t(i)(this,"sendIdentifyEvent",((e,t,r)=>{this.setUserInfo(e,t);const s={userIdType:e,eventType:a.eventType.IDENTIFY};return this._processEvent(t,s,this._context,r)})),t(i)(this,"sendPageEvent",((e,t)=>this.sendScreenEvent(e,t))),t(i)(this,"sendScreenEvent",((e,t,r)=>{let s,i,n,o;"object"==typeof e?(s=e.name,i=e.attributes,n=e.containers,o=e.tags):(s=e,i=r),(0,h.validateScreenEvent)(s),(0,h.validateContainers)(n);const a=(0,l.buildScreenEvent)(this._productInfo,this._tenantInfo,this._userInfo,i,e.nonPrivacySafeAttributes,o,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,e,n),c=S({name:s},a);return this._setLastScreenEvent(c),this._processEvent(s,a,this._context,(0,O.default)(t,c))})),t(i)(this,"sendTrackEvent",((e,t)=>{(0,h.validateTrackEvent)(e);const r=(0,l.buildActionEvent)(this._productInfo,this._tenantInfo,this._userInfo,e,a.eventType.TRACK,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId);return this._processEvent((0,l.buildActionName)(e),r,this._context,(0,O.default)(t,r))})),t(i)(this,"sendUIEvent",((e,t)=>{(0,h.validateUIEvent)(e);const r=(0,l.buildActionEvent)(this._productInfo,this._tenantInfo,this._userInfo,e,a.eventType.UI,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId);return this._processEvent((0,l.buildActionName)(e),r,this._context,(0,O.default)(t,r))})),t(i)(this,"sendOperationalEvent",((e,t)=>{(0,h.validateOperationalEvent)(e);const r=(0,l.buildActionEvent)(this._productInfo,this._tenantInfo,this._userInfo,e,a.eventType.OPERATIONAL,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId);return this._processEvent((0,l.buildActionName)(e),r,this._context,(0,O.default)(t,r))})),t(i)(this,"startUIViewedEvent",(e=>{this.stopUIViewedEvent(),this._uiViewedEvent=new(0,I.default)(this._productInfo,(()=>({embeddedProduct:this._productInfo.embeddedProduct(),subproduct:this._productInfo.subproduct(),tenantIdType:this._tenantInfo.tenantIdType,tenantId:this._tenantInfo.tenantId,userId:this._userInfo.userId,lastScreenEvent:this._getLastScreenEvent(),attributes:this._uiViewedAttributes})),(t=>this.sendUIEvent(t,e))),this._uiViewedEvent.start()})),t(i)(this,"stopUIViewedEvent",(()=>{this._uiViewedEvent&&(this._uiViewedEvent.stop(),this._uiViewedEvent=null)})),t(i)(this,"resetUIViewedTimers",(()=>{this._uiViewedEvent&&this._uiViewedEvent.resetTimers()})),t(i)(this,"startApdexEvent",(e=>{this._apdexEvent.start(e)})),t(i)(this,"getApdexStart",(e=>this._apdexEvent.getStart(e))),t(i)(this,"stopApdexEvent",((e,t)=>{this._apdexEvent.stop(e,t)})),t(i)(this,"startLowPriorityEventDelay",((e,t)=>{this.eventDelayQueue.startLowPriorityEventDelay(e,t)})),t(i)(this,"stopLowPriorityEventDelay",(()=>{this.eventDelayQueue.stopLowPriorityEventDelay()})),t(i)(this,"onEvent",((e,t)=>{if(!t)throw new Error("Missing analyticsData");if(!t.eventType)throw new Error("Missing analyticsData.eventType");if(t.eventType===a.eventType.TRACK)return this.sendTrackEvent(t);if(t.eventType===a.eventType.UI)return this.sendUIEvent(t);if(t.eventType===a.eventType.OPERATIONAL)return this.sendOperationalEvent(t);if(t.eventType===a.eventType.SCREEN)return this.sendScreenEvent(t.name,null,t.attributes);if(t.eventType===a.eventType.IDENTIFY)return this.sendIdentifyEvent(t.userIdType,t.userId);throw new Error(`Invalid analyticsData.eventType '${t.eventType}', must be an eventType: [${(0,a.objectValues)(a.eventType)}]`)})),!e)throw new Error("Missing productInfo");if(!e.env)throw new Error("Missing productInfo.env");if(!e.product)throw new Error("Missing productInfo.product");if(!(0,a.isType)(a.envType,e.env))throw new Error(`Invalid productInfo.env '${e.env}', must be an envType: [${(0,a.objectValues)(a.envType)}]`);if(e.origin){if(!(0,a.isType)(a.originType,e.origin))throw new Error(`Invalid productInfo.origin '${e.origin}', must be an originType: [${(0,a.objectValues)(a.originType)}]`)}else e.origin=a.originType.WEB;e.platform?(0,h.validatePlatform)(e):e.platform=e.origin===a.originType.WEB?a.platformType.WEB:a.platformType.DESKTOP,this.logger=r.logger||console,this._productInfo=S(S({},e),{},{subproduct:this._createSubproductGetter(e.subproduct),embeddedProduct:this._createEmbeddedProductGetter(e.embeddedProduct)}),this._tenantInfo={},this._orgInfo={},this._uiViewedAttributes={},this._context=(0,l.buildContext)(this._productInfo),this._safeSessionStorage=new(0,y.default);const s=this._useStargate(r.useStargate),n=r.apiHost||this._selectHost({useStargate:s,env:e.env,useLegacyUrl:r.useLegacyUrl}),_={maxRetryDelay:6e4,minRetryDelay:r.minRetryDelay||1e3,backoffFactor:2,flushWaitMs:r.flushWaitInterval,flushBeforeUnload:r.flushBeforeUnload},D=`awc-${e.env}`;this.eventProcessor=new(0,p.default)({apiHost:n,product:e.product,retryQueuePrefix:D,retryQueueOptions:_,xidPromiseGetter:()=>(0,T.XIDPromise)(r.xidConsent,r.xidPromiseFn),logger:this.logger}),this._userInfo={anonymousId:this.eventProcessor.getUser().getAnonymousId()},this._pageVisibility=new(0,m.default),this._tabTracking=new(0,v.default),this._sessionTracking=new(0,g.default)({sessionExpiryTime:r.sessionExpiryTime}),this.task=new(0,b.default),this.originTracing=new(0,f.default),this._apdexEvent=new(0,c.default)(this.sendOperationalEvent,this._pageVisibility),this._historyReplaceFn="function"==typeof r.historyReplaceFn?r.historyReplaceFn:w.defaultHistoryReplaceFn,this.eventDelayQueue=new(0,d.default)(this._fireDelayedEvent,r.delayQueueCompressors||[]),this._testingCache=new(0,E.default),this._pageLoadId=t(o)()}}})),n.register("8ymt6",(function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports})),n.register("fWyjG",(function(e,t){var r=n("h3j8S"),s=n("dyzXo");e.exports=function(e,t,i){var n=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[n+a]=o[a];return t||s(o)}})),n.register("h3j8S",(function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var s=new Uint8Array(16);e.exports=function(){return r(s),s}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}})),n.register("dyzXo",(function(e,t){for(var r=[],s=0;s<256;++s)r[s]=(s+256).toString(16).substr(1);e.exports=function(e,t){var s=t||0,i=r;return[i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]]].join("")}})),n.register("19ezt",(function(t,r){let s;var i;let n;var o;let a;var c;let u;var l;let d;var h;let p;var f;let m;var g;e(t.exports,"envType",(()=>s)),e(t.exports,"eventType",(()=>n)),e(t.exports,"platformType",(()=>a)),e(t.exports,"originType",(()=>u)),e(t.exports,"tenantType",(()=>d)),e(t.exports,"userType",(()=>p)),e(t.exports,"apdexType",(()=>m)),e(t.exports,"desktopPlatforms",(()=>y)),e(t.exports,"webPlatforms",(()=>v)),e(t.exports,"originTracingType",(()=>b)),e(t.exports,"objectValues",(()=>E)),e(t.exports,"isType",(()=>I)),(i=s||(s={})).LOCAL="local",i.DEV="dev",i.STAGING="staging",i.PROD="prod",(o=n||(n={})).TRACK="track",o.UI="ui",o.OPERATIONAL="operational",o.SCREEN="screen",o.IDENTIFY="identify",(c=a||(a={})).MAC="mac",c.LINUX="linux",c.WINDOWS="windows",c.DESKTOP="desktop",c.WEB="web",c.MOBILE_WEB="mobileWeb",(l=u||(u={})).DESKTOP="desktop",l.WEB="web",(h=d||(d={})).CLOUD_ID="cloudId",h.ORG_ID="orgId",h.OPSGENIE_CUSTOMER_ID="opsgenieCustomerId",h.HALP_TEAM_ID="halpTeamId",h.NONE="none",(f=p||(p={})).ATLASSIAN_ACCOUNT="atlassianAccount",f.HASHED_EMAIL="hashedEmail",f.TRELLO="trello",f.OPSGENIE="opsgenie",f.HALP="halp",(g=m||(m={})).TRANSITION="transition",g.INITIAL_LOAD="initialLoad";const y=Object.freeze([a.DESKTOP,a.MAC,a.LINUX,a.WINDOWS]),v=Object.freeze([a.WEB,a.MOBILE_WEB]);let b;function E(e){return Object.values(e)}function I(e,t){return Object.values(e).indexOf(t)>-1}(b||(b={})).ATL_ORIGIN="atlOrigin"})),n.register("aALk9",(function(r,s){e(r.exports,"default",(()=>d));var i=n("8ymt6"),o=n("19ezt"),a=n("gqScn"),c=n("k9Wfu");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function l(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?u(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):u(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class d{constructor(e,r){if(t(i)(this,"_getEventKey",(({task:e,taskId:t})=>t?`${e}.${t}`:e)),t(i)(this,"_getEventTimingByName",(e=>{const t=this._performance.getEntriesByName(e);return t[t.length-1]})),t(i)(this,"_getApdexFields",(e=>{const t=this._getApdexTimings(e),r=this._calculateApdex({duration:t.duration,threshold:e.threshold});return l(l({},t),{},{apdex:r})})),t(i)(this,"_getApdexTimings",(e=>{const t=this._getEventKey(e),r=`${t}-start`,s=e.startTime||this._getStartTime(e,r),i=e.stopTime||this._getStopTime();return this._cleanApdexState(t),{startTime:s,stopTime:i,duration:i-s}})),t(i)(this,"_getStartTime",((e,t)=>{let r;const s=this._performance.getTimeOrigin();if(e.type===o.apdexType.INITIAL_LOAD)r=s;else{r=s+this._getEventTimingByName(t).startTime}return r})),t(i)(this,"_getStopTime",(()=>this._performance.getTimeOrigin()+this._performance.now())),t(i)(this,"_cleanApdexState",(e=>{this._performance.clearMarks(`${e}-start`),this._performance.clearMarks(`${e}-stop`),this._startedEvents.delete(e)})),t(i)(this,"_getVisibilityFields",(e=>{let t;if(e.type===o.apdexType.INITIAL_LOAD)t=!this._wasPreviouslyHidden;else if(e.type===o.apdexType.TRANSITION){const r=this._getEventKey(e);t=this._isActiveEvents.get(r)}return(e.startTime||e.stopTime)&&(t=!this._pageVisibility.getIsHidden()),{isActiveTab:t}})),t(i)(this,"_calculateApdex",(({duration:e,threshold:t=this._threshold})=>{let r;return r=e<=t?1:e<=4*t?.5:0,r})),t(i)(this,"_validateStartEvent",(e=>{if(!e)throw new Error('Missing "event" in Apdex start event');if(!e.task)throw new Error('Missing "task" in Apdex start event');if("string"!=typeof e.task)throw new Error('Invalid "task" in Apdex start event');if(e.taskId&&"string"!=typeof e.taskId)throw new Error('Invalid "taskId" in Apdex start event')})),t(i)(this,"_validateStopEvent",(e=>{if(!e)throw new Error('Missing "event" in Apdex stop event');if(!e.task)throw new Error('Missing "task" in Apdex stop event');if("string"!=typeof e.task)throw new Error('Invalid "task" in Apdex stop event');if(e.taskId&&"string"!=typeof e.taskId)throw new Error('Invalid "taskId" in Apdex stop event');if(!e.type)throw new Error('Missing "type" in Apdex stop event');if(e.type&&!(0,o.isType)(o.apdexType,e.type))throw new Error('Invalid "type" in Apdex stop event');if(e.threshold&&"number"!=typeof e.threshold)throw new Error('Invalid "threshold" in Apdex stop event');if(!e.startTime&&e.type===o.apdexType.TRANSITION){const t=this._getEventKey(e);if(!this._startedEvents.has(t))throw new Error(`Apdex event transition "${t}" was not started`)}if(e.startTime&&!("number"==typeof e.startTime&&e.startTime>=0))throw new Error('Invalid "startTime" in Apdex stop event');if(e.stopTime&&"number"!=typeof e.stopTime)throw new Error('Invalid "stopTime" in Apdex stop event');if(e.stopTime<=e.startTime)throw new Error('"stopTime" should be greater than "startTime" in Apdex stop event')})),t(i)(this,"_shouldSendEvent",(e=>!!e&&"number"==typeof e.apdex)),t(i)(this,"_sendEvent",((e,t)=>{this._shouldSendEvent(e)&&this._onEvent({source:"ui",action:"readyForUser",actionSubject:"ui",attributes:l(l({},e.additionalAttributes),{},{task:e.task,taskId:e.taskId,type:e.type,threshold:e.threshold||this._threshold,apdex:e.apdex,startTime:e.startTime,stopTime:e.stopTime,duration:e.duration,isActiveTab:e.isActiveTab})},t)})),!e)throw new Error("Missing onEvent callback");if("function"!=typeof e)throw new Error("Invalid onEvent, must be function");if(!(r instanceof a.default))throw new Error("Invalid pageVisibility, must be PageVisibility class");this._startedEvents=new Map,this._performance=new(0,c.default),this._onEvent=e,this._threshold=1e3,this._wasPreviouslyHidden=r.getIsHidden(),this._isActiveEvents=new Map,this._pageVisibility=r,this._pageVisibility.addCallback("apdexEvent",(e=>{this.onVisibilityChange(!e)}))}start(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;const t=this._getEventKey(e),r=`${t}-start`;this._startedEvents.set(t,!0),this._isActiveEvents.set(t,!this._pageVisibility.getIsHidden()),this._performance.clearMarks(r),this._performance.mark(r)}getStart(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;const t=`${this._getEventKey(e)}-start`;return this._getEventTimingByName(t)}stop(e,t){if(this._validateStopEvent(e),!this._performance.isAvailable())return;const r=this._getApdexFields(e),s=this._getVisibilityFields(e);this._sendEvent(l(l(l({},e),r),s),t)}onVisibilityChange(e){e||(this._wasPreviouslyHidden=!0,this._isActiveEvents.forEach(((e,t)=>this._isActiveEvents.set(t,!1))))}}})),n.register("gqScn",(function(r,s){e(r.exports,"default",(()=>o));var i=n("8ymt6");class o{constructor(){t(i)(this,"_bindEventListeners",(()=>{document.addEventListener(this._visibilityChange,this._handleVisibilityChange,!1)})),t(i)(this,"_handleVisibilityChange",(()=>{const e=document[this._hidden];this._isHidden=e,this._callbacks.forEach((t=>t(e)))})),this._isHidden=!1,this._callbacks=new Map,this._hidden=void 0,this._visibilityChange=void 0,void 0!==document.hidden?(this._isHidden=document.hidden,this._hidden="hidden",this._visibilityChange="visibilitychange"):void 0!==document.msHidden?(this._isHidden=document.msHidden,this._hidden="msHidden",this._visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(this._isHidden=document.webkitHidden,this._hidden="webkitHidden",this._visibilityChange="webkitvisibilitychange"),void 0!==document.addEventListener&&void 0!==this._hidden&&this._bindEventListeners()}addCallback(e,t){if("string"!=typeof e)throw new Error("Invalid name, must be string");if("function"!=typeof t)throw new Error("Invalid callback, must be function");this._callbacks.set(e,t)}removeCallback(e){this._callbacks.has(e)&&this._callbacks.delete(e)}getIsHidden(){return this._isHidden}}})),n.register("k9Wfu",(function(t,r){e(t.exports,"default",(()=>s));class s{constructor(){this._performance=window.performance}clearMarks(...e){this._performance&&this._performance.clearMarks&&this._performance.clearMarks(...e)}mark(...e){this._performance&&this._performance.mark&&this._performance.mark(...e)}getEntriesByName(...e){return this._performance&&this._performance.getEntriesByName?this._performance.getEntriesByName(...e):[]}getTimeOrigin(){return this._performance&&(this._performance.timeOrigin||this._performance.timing)?this._performance.timeOrigin||this._performance.timing.navigationStart:0}now(){return this._performance&&this._performance.now?this._performance.now():Date.now?Date.now():+new Date}isAvailable(){return!!(this._performance&&this._performance.clearMarks&&this._performance.mark&&this._performance.getEntriesByName&&this._performance.timing)}}})),n.register("dZAxt",(function(t,r){e(t.exports,"default",(()=>s));var s=(e,t)=>()=>{if((e=>"function"==typeof e)(e))try{return e()}catch(e){return void console.error(`${t} - ${e.message}`)}return e}})),n.register("5T591",(function(r,s){e(r.exports,"buildActionFields",(()=>b)),e(r.exports,"buildScreenEvent",(()=>E)),e(r.exports,"buildActionName",(()=>I)),e(r.exports,"buildContext",(()=>w)),e(r.exports,"buildActionEvent",(()=>O));var i=n("8ymt6"),o=n("19ezt"),a=n("8jnXy");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function u(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?c(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):c(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function l(e){return{tenantIdType:e.tenantIdType,tenantId:e.tenantId}}function d(e){return{userIdType:e.userIdType}}function h(e){return{orgId:e.orgId}}function p(e){return e.anonymousId?{anonymousId:e.anonymousId}:{}}function f(e,t){return void 0===t?e:t}function m(e,t){const r=t||{};return{env:f(e.env,r.env),product:f(e.product,r.product),subproduct:f(e.subproduct(),r.subproduct),version:f(e.version,r.version),origin:f(e.origin,r.origin),platform:f(e.platform,r.platform)}}function g(e){return(0,a.isPlainObject)(e)&&Object.keys(e).length>0}function y(e,t){return g(t)?{[e]:t}:void 0}function v(e){if(g(e)){const t=function(e){const t={};return Object.keys(e).forEach((r=>{const s=e[r];t[r]={id:s.id,type:s.type}})),t}(e);return y("containers",t)}}function b(e,t){return u({containerType:e.containerType,containerId:e.containerId,source:e.source,objectType:e.objectType,objectId:e.objectId,actionSubject:e.actionSubject,action:e.action,actionSubjectId:e.actionSubjectId,attributes:e.attributes,nonPrivacySafeAttributes:e.nonPrivacySafeAttributes,tags:e.tags,highPriority:e.highPriority,eventType:t},v(e.containers))}function E(e,t,r,s,i,n,a,c,f,g,b,E,I){const w=m(e),O=l(t),T=d(r),_=h(g),S={title:"",path:"",url:"",referrer:"",search:"",eventType:o.eventType.SCREEN};return u(u(u(u(u(u(u(u(u(u({},w),O),T),_),S),function(e){return y("attributes",e)}(s)),function(e){return y("nonPrivacySafeAttributes",e)}(i)),v(I)),p(E)),{},{tags:n,tabId:a,sessionId:c,taskSessions:f,pageLoadId:b})}function I(e){return`${e.actionSubject} ${e.action}`}function w(e){const t=window.screen||{};return{context:{locale:e.locale,screen:{width:t.width,height:t.height,density:window.devicePixelRatio},library:{name:"analytics.js",version:"4.7.2"}}}}function O(e,t,r,s,i,n,o,a,c,f){const g=m(e,function(e){const{env:t,product:r,subproduct:s,version:i,origin:n,platform:o}=e;return{env:t,product:r,subproduct:s,version:i,origin:n,platform:o}}(s)),y=l(t),v=h(c),E=d(r),I=b(s,i);return u(u(u(u(u(u(u({},g),y),v),E),I),p(s)),{},{tabId:n,sessionId:o,taskSessions:a,pageLoadId:f})}})),n.register("8jnXy",(function(t,r){function s(e){return!0==(null!==(t=e)&&"object"==typeof t&&!1===Array.isArray(t))&&"[object Object]"===Object.prototype.toString.call(e);var t}function i(e){if(!1===s(e))return!1;const t=e.constructor;if("function"!=typeof t)return!1;const r=t.prototype;return!1!==s(r)&&"isPrototypeOf"in r}e(t.exports,"isPlainObject",(()=>i))})),n.register("7ndiM",(function(r,s){e(r.exports,"default",(()=>u));var i=n("8ymt6"),o=n("5WWwO"),a=n("8b7eC"),c=n("fyYDf");class u{constructor(e,r){t(i)(this,"push",((e,t,r,s)=>{this.delayQueue.push(e,t,r,s)})),t(i)(this,"startLowPriorityEventDelay",((e=o.DEFAULT_DELAY_TIMEOUT,t)=>{if(Number.isNaN(e)||e<=0)throw new Error(`Invalid timeout period: ${e}, must be a number greater than 0`);this.delayTimeout&&clearTimeout(this.delayTimeout);const r=e?Math.min(e,o.MAX_DELAY_TIMEOUT):o.MAX_DELAY_TIMEOUT;this.delayCallback=t,this.delayTimeout=setTimeout((()=>this.stopLowPriorityEventDelay(c.StopLowPriorityEventDelayReason.TIMEOUT)),r),this.delayQueue.cancelFlush(),this.isDelaying=!0})),t(i)(this,"stopLowPriorityEventDelay",((e=c.StopLowPriorityEventDelayReason.MANUAL)=>{var t;this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=void 0),this.delayQueue.startFlush(),this.isDelaying=!1,null===(t=this.delayCallback)||void 0===t||t.call(this,e),this.delayCallback=void 0})),t(i)(this,"isDelayingLowPriorityEvents",(()=>this.isDelaying)),this.isDelaying=!1,this.delayQueue=new(0,a.default)(e,r)}}})),n.register("5WWwO",(function(t,r){e(t.exports,"DEFAULT_DELAY_TIMEOUT",(()=>s)),e(t.exports,"MAX_DELAY_TIMEOUT",(()=>i));const s=1e4,i=3e4})),n.register("8b7eC",(function(r,s){e(r.exports,"default",(()=>u));var i=n("8ymt6"),o=n("5T591"),a=n("fT9bc"),c=n("hfGYO");class u{constructor(e,r){t(i)(this,"push",((e,t,r,s)=>{this.eventArgs.push({identifier:e,builtEvent:t,context:r,userInfo:s})})),t(i)(this,"size",(()=>this.eventArgs.length)),t(i)(this,"startFlush",(()=>{try{this.eventArgs=this.compressEventArgs(this.eventArgs)}catch(e){console.warn(`Failed to perform compression on the delayed analytics events. Error: ${e.message}. Sending ${this.eventArgs.length} uncompressed events instead`)}this.flushNextBatch()})),t(i)(this,"cancelFlush",(()=>{this.flushBatchTimeout&&(clearTimeout(this.flushBatchTimeout),this.flushBatchTimeout=null)})),t(i)(this,"flushNextBatch",(()=>{this.eventArgs.splice(0,7).forEach((e=>this.processFn(e.identifier,e.builtEvent,e.context,e.userInfo))),this.eventArgs.length>0?this.flushBatchTimeout=setTimeout((()=>this.flushNextBatch()),100):this.flushBatchTimeout=null})),t(i)(this,"compressEventArgs",(e=>{const[t,r]=(0,a.partition)(e,(e=>this.compressor.canCompress(e.builtEvent))),s=t.reduce(((e,t)=>{const r=e.find((e=>(0,a.equals)(e.userInfo,t.userInfo)&&(0,a.equals)(e.context,t.context)));return r?r.eventArgs.push(t):e.push({userInfo:t.userInfo,context:t.context,eventArgs:[t]}),e}),[]).reduce(((e,t)=>{try{const r=t.eventArgs.map((e=>e.builtEvent)),s=this.compressor.compress(r).map((e=>({identifier:(0,o.buildActionName)(e),builtEvent:e,userInfo:t.userInfo,context:t.context})));return e.concat(s)}catch(e){return console.warn(`Failed to compress some analytics events. Error: ${e.message}. Sending ${t.eventArgs.length} uncompressed events instead`),t.eventArgs}}),[]);return r.forEach((e=>s.push(e))),s})),this.processFn=e,this.flushBatchTimeout=null,this.eventArgs=[],this.compressor=new(0,c.default)(r)}}})),n.register("fT9bc",(function(t,r){e(t.exports,"mapKeys",(()=>s)),e(t.exports,"pick",(()=>i)),e(t.exports,"omitBy",(()=>n)),e(t.exports,"pickBy",(()=>o)),e(t.exports,"omit",(()=>a)),e(t.exports,"equals",(()=>c)),e(t.exports,"partition",(()=>u));const s=(e,t)=>Object.keys(e).reduce(((r,s)=>(r[t(e[s],s,e)]=e[s],r)),{}),i=(e,t)=>t.reduce(((t,r)=>(r in e&&(t[r]=e[r]),t)),{}),n=(e,t)=>Object.keys(e).filter((r=>!t(e[r],r))).reduce(((t,r)=>(t[r]=e[r],t)),{}),o=(e,t)=>Object.keys(e).filter((r=>t(e[r],r))).reduce(((t,r)=>(t[r]=e[r],t)),{}),a=(e,t)=>Object.keys(e).filter((e=>t.indexOf(e)<0)).reduce(((t,r)=>(t[r]=e[r],t)),{}),c=(e,t)=>{if(e===t)return!0;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return e===t;if(e.prototype!==t.prototype)return!1;const r=Object.keys(e);return r.length===Object.keys(t).length&&r.every((r=>c(e[r],t[r])))},u=(e,t)=>e.reduce(((e,r,s,i)=>(e[t(r,s,i)?0:1].push(r),e)),[[],[]])})),n.register("hfGYO",(function(r,s){e(r.exports,"default",(()=>d));var i=n("8ymt6"),o=n("5T591"),a=n("fT9bc"),c=n("iqi8L");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function l(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?u(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):u(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class d{constructor(e=[]){if(t(i)(this,"canCompress",(e=>this.compressionRules.some((t=>t.canCompress(e))))),t(i)(this,"compress",(e=>this.createGroups(e).reduce(((e,t)=>{const r=this.compressGroup(t);return e.concat(r)}),[]))),t(i)(this,"createGroups",(e=>e.reduce(((e,t)=>{const r=this.compressionRules.find((e=>e.canCompress(t)));let s;if(r){const e=(0,o.buildActionFields)(t,t.eventType);s=(0,a.omit)(t,Object.keys(e))}const i=e.find((e=>r===e.compressor&&(0,a.equals)(s,e.contextFields)));return i?i.events.push(t):e.push({contextFields:s,compressor:r,events:[t]}),e}),[]))),t(i)(this,"compressGroup",(e=>{if(!e.compressor)return e.events;try{return e.compressor.compress(e.events).map((t=>l(l({},t),e.contextFields)))}catch(t){return console.warn(`Failed to compress some analytics events. Error: ${t.message}. Sending ${e.events.length} uncompressed events instead`),e.events}})),!Array.isArray(e))throw new Error("Event compressors must be constructed with an array of CompressionRules");if(!e.every((e=>e instanceof c.CompressionRule)))throw new Error("Event compressors can only be constructed with instances of CompressionRule");this.compressionRules=e}}})),n.register("iqi8L",(function(r,s){e(r.exports,"CompressionRule",(()=>c));var i=n("8ymt6"),o=n("kWYz4"),a=n("fT9bc");class c{constructor(e,r){if(t(i)(this,"canCompress",(e=>{try{return e&&(0,o.isActionEventType)(e.eventType)&&this.predicate(e)}catch(e){return!1}})),t(i)(this,"compress",(e=>{const[t,r]=(0,a.partition)(e,(e=>this.canCompress(e))),s=this.compressFn(t);if(!s)throw new Error("No events were returned from the compression function");return s.forEach((e=>{(0,o.validateActionEventType)(e.eventType),(0,o.validateActionEvent)(e)})),s.concat(r)})),"function"!=typeof e)throw new Error("Invalid predicate, must be a function that accepts an event and returns a boolean");if("function"!=typeof r)throw new Error("Invalid compressFn, must be a function that both accepts and returns an array of events");this.predicate=e,this.compressFn=r}}})),n.register("kWYz4",(function(t,r){e(t.exports,"validateContainers",(()=>a)),e(t.exports,"isActionEventType",(()=>c)),e(t.exports,"validateActionEventType",(()=>u)),e(t.exports,"validateActionEvent",(()=>l)),e(t.exports,"validateScreenEvent",(()=>d)),e(t.exports,"validateTrackEvent",(()=>h)),e(t.exports,"validateUIEvent",(()=>p)),e(t.exports,"validateOperationalEvent",(()=>f)),e(t.exports,"validateIdentifyEvent",(()=>m)),e(t.exports,"validatePlatform",(()=>g));var s=n("19ezt"),i=n("8jnXy");const o=Object.freeze([s.eventType.OPERATIONAL,s.eventType.TRACK,s.eventType.UI]);function a(e){if(e){if(e&&e.constructor!==Object)throw new Error("properties.containers must be an Object");Object.values(e).forEach((e=>function(e){if(!(0,i.isPlainObject)(e))throw new Error("properties.containers must be an Object");if(!("id"in e))throw new Error("properties.containers is missing field 'id'");if("string"!=typeof e.id)throw new Error("properties.containers.id must be of type String");if("type"in e&&"string"!=typeof e.type)throw new Error("properties.containers.type must be of type String")}(e)))}}function c(e){switch(e){case s.eventType.OPERATIONAL:case s.eventType.TRACK:case s.eventType.UI:return!0;default:return!1}}function u(e){if(!c(e))throw new Error(`Invalid action event type: ${e}, must be one of: [${o}]`);return!0}function l(e){if(!e)throw new Error("Missing event");if(!e.source)throw new Error("Missing event.source");if(!e.actionSubject)throw new Error("Missing event.actionSubject");if(!e.action)throw new Error("Missing event.action");a(e.containers)}function d(e){if(!e)throw new Error("Missing name")}function h(e){l(e)}function p(e){l(e)}function f(e){l(e)}function m(e,t){if(!e)throw new Error("Missing userIdType");if(!t)throw new Error("Missing userId");if(!(0,s.isType)(s.userType,e))throw new Error(`Invalid userIdType '${e}', must be an userType: [${(0,s.objectValues)(s.userType)}]`)}function g(e){if(!(0,s.isType)(s.platformType,e.platform))throw new Error(`Invalid productInfo.platform '${e.platform}', must be a platformType: [${(0,s.objectValues)(s.platformType)}]`);if(e.origin===s.originType.DESKTOP&&!(0,s.isType)(s.desktopPlatforms,e.platform))throw new Error(`Invalid productInfo.platform '${e.platform}', must be one of [mac, linux, windows]`);if(e.origin===s.originType.WEB&&!(0,s.isType)(s.webPlatforms,e.platform))throw new Error(`Invalid productInfo.platform '${e.platform}', must be one of [web, mobileWeb]`)}})),n.register("fyYDf",(function(t,r){let s;var i;e(t.exports,"StopLowPriorityEventDelayReason",(()=>s)),(i=s||(s={})).TIMEOUT="timeout",i.MANUAL="manual"})),n.register("6gXvm",(function(r,s){e(r.exports,"default",(()=>y));var i=n("8ymt6"),o=n("fWyjG"),a=n("6TmCU"),c=n("jJOAQ"),u=n("aDDvw"),l=n("1I6pE"),d=n("j9VsO"),h=n("25Iz6"),p=n("jvRBd"),f=n("doiol");function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function g(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?m(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):m(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class y{constructor(e){t(i)(this,"sendEvents",(async(e,t)=>{const r=this.resilienceQueue.getGlobalRetryCount(),s=this.metrics.getMetricsPayload(),i=g(g({},s),{},{httpRetryCount:r});for(let e in i)0===i[e]&&delete i[e];const n=await this.attachXIDs(e),o=(new Date).toISOString(),a={batch:n.map((e=>(e.msg.sentAt=o,e.msg))),sentAt:o,metadata:i};try{const e=await(0,d.sendEvents)({url:this.gasv3BatchUrl,batch:a,timeout:this.options.requestTimeout});this.metrics.subtractFromMetrics(s),t(null,e)}catch(e){t(e,null)}})),this.user=new(0,p.default),this.options=g(g({},e),{},{requestTimeout:e.requestTimeout||l.DEFAULT_REQUEST_TIMEOUT,retryQueueOptions:e.retryQueueOptions||{},logger:e.logger||console}),this.xidPromiseCallback=e.xidPromiseGetter(),this.gasv3BatchUrl=`https://${e.apiHost}/batch`,this.metrics=(0,c.default)(),this.resilienceQueue=(0,a.default)(e.retryQueuePrefix,e.product,this.options.retryQueueOptions,this.options.logger),this.resilienceQueue.start(this.sendEvents)}getUser(){return this.user}async track(e,t,r,s){const i=g(g({},this.buildBaseEvent(r,h.SegmentEventTypes.TRACK,t)),{},{type:h.SegmentEventTypes.TRACK,properties:(0,f.prepareEventProperties)(t),event:e}),n=g(g({},i),{},{messageId:this.createMessageId()}),o=this.packageEvent(n);await this.resilienceQueue.addItem(o),s&&s()}async page(e,t,r,s){const i=g(g({},this.buildBaseEvent(r,h.SegmentEventTypes.PAGE,t)),{},{type:h.SegmentEventTypes.PAGE,properties:(0,f.prepareEventProperties)(t),name:e}),n=g(g({},i),{},{messageId:this.createMessageId()}),o=this.packageEvent(n);await this.resilienceQueue.addItem(o),s&&s()}async identify(e,t,r,s){const i=g(g({},this.buildBaseEvent(r,h.SegmentEventTypes.IDENTIFY,t)),{},{type:h.SegmentEventTypes.IDENTIFY,traits:(0,f.prepareEventProperties)(t)}),n=g(g({},i),{},{messageId:this.createMessageId()}),o=this.packageEvent(n);await this.resilienceQueue.addItem(o),s&&s()}buildBaseEvent(e,t,r){const s=(0,f.prepareEventProperties)(e);return{context:(0,f.buildContext)(s),timestamp:(new Date).toISOString(),type:t,userId:this.user.getUserId(),anonymousId:r.anonymousId||this.user.getAnonymousId()}}createMessageId(){return`ajs-${t(o)()}`}packageEvent(e){const{apiHost:t}=this.options;return{headers:{"Content-Type":"text/plain"},msg:e,url:`https://${t}/${e.type.charAt(0)}`}}async attachXIDs(e){return this.xidPromiseCallback?(0,u.attachXidToMultipleEvents)(e,this.xidPromiseCallback):Promise.resolve(e)}}})),n.register("6TmCU",(function(t,r){e(t.exports,"default",(()=>i));var s=n("4q03D"),i=(e,t,r,i)=>new(0,s.default)(e,t,r||{},i)})),n.register("4q03D",(function(r,s){e(r.exports,"default",(()=>x));var i=n("8ymt6"),o=n("apnBy"),a=n("lzLew"),c=n("eXTDJ"),u=n("jnNAC"),l=n("4rlmz"),d=n("jJOAQ"),h=n("iH1Zw"),p=n("eOVWY"),f=n("faIK1"),m=n("jZuTq");function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function y(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?g(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):g(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const v=6e4,b={backoffFactor:0,backoffJitterPercentage:0,flushWaitMs:v,minRetryDelay:v,maxRetryDelay:v},E=2,I=.2,w=7,O=!1,T=500,_=10,S=1e3,A=3e4,D=1e3;class x{constructor(e,t,r,s){this.queuePrefix=e,this.resilience=new(0,c.default)(t,{logger:s,maxAttempts:null==r?void 0:r.maxAttempts,maxEventLimit:null==r?void 0:r.maxItems}),this.options=this.buildOptions(r),this.scheduler=new(0,p.default)(y(y({},this.options),{},{waitInterval:null!=r&&r.flushBeforeUnload?0:this.options.flushWaitMs}),this.scheduleCallback.bind(this)),this.longPollingScheduler=new(0,p.default)(y(y({},b),{},{waitInterval:b.flushWaitMs}),this.scheduleLongCallBack.bind(this)),this.metricsCollector=(0,d.default)(),this.networkStatus=new(0,h.default)((e=>{e===m.NetworkStatusEnum.OFFLINE?this.scheduler.stop():this.checkEventCountAndReschedule()}))}start(e){this.batchFlushCallback=e,this.longPollingScheduler.schedule()}stop(){this.scheduler.stop(),this.longPollingScheduler.stop()}async addItem(e){const t=JSON.parse(JSON.stringify(e)),{numberOfEvictedItems:r}=await this.resilience.addItem(t,{},u.GuardPolicy.EVICT);this.scheduler.schedule(),this.metricsCollector.addToEventCount(),r>0&&this.metricsCollector.addToItemsDiscardedByOverflowCounter(r)}getGlobalRetryCount(){return this.scheduler.getFailureCount()}async scheduleCallback(e){if(this.networkStatus.getNetworkStatus()!==m.NetworkStatusEnum.OFFLINE)try{e(await this.resilience.processItems(this.flush.bind(this),this.options.batchFlushSize))}catch(t){if(t.name===l.CallbackProcessingErrorName)return void e(f.DoneState.ERROR)}finally{await this.checkEventCountAndReschedule()}else e(f.DoneState.NOOP)}async checkEventCountAndReschedule(){const e=await this.resilience.getItemCount();e>0&&this.scheduler.schedule({immediate:e>=this.options.batchFlushSize})}async scheduleLongCallBack(e){const t=(0,o.default)(this.queuePrefix);this.metricsCollector.addToPurgedQueuesMetrics(t);const r=await(0,a.default)(this.queuePrefix,(async e=>{const t=e.map((e=>({item:e.item,retryAttempts:e.attemptNumber,id:e.id}))),{items:r}=await this.resilience.bulkAddItem(t,u.GuardPolicy.IGNORE);return r.length===t.length?{status:"successful"}:{status:"partial",acceptedItemIds:r.map((e=>e.id))}}));this.metricsCollector.addToReclaimMetrics(r),await this.checkEventCountAndReschedule(),e(f.DoneState.SUCCESS),this.longPollingScheduler.schedule()}flush(e,t){this.metricsCollector.setResilienceMechanism(this.resilience.storeType());const{batchFlushCallback:r}=this;if(!r)throw new Error("batchFlushCallback has not been set. Call PullBatchableQueue#start first.");return new Promise(((s,i)=>{if(e.length<=0)return void s(f.DoneState.NOOP);const n=e.map((e=>{const t=e.item;return e.retryAttempts>0&&t.msg&&(t.msg._metadata||(t.msg._metadata={}),t.msg._metadata.failedAttempts=e.retryAttempts),t}));r(n,(e=>{e?(t.numberOfDeletedItems>0&&this.metricsCollector.addToItemsDiscardedByRetryCounter(t.numberOfDeletedItems),i(e)):s(f.DoneState.SUCCESS)}))}))}buildOptions(e){return{backoffFactor:(null==e?void 0:e.backoffFactor)||E,backoffJitterPercentage:void 0!==(null==e?void 0:e.backoffJitterPercentage)?e.backoffJitterPercentage:I,batchFlushSize:(null==e?void 0:e.batchFlushSize)||w,flushBeforeUnload:(null==e?void 0:e.flushBeforeUnload)||O,flushWaitMs:(null==e?void 0:e.flushWaitMs)||T,maxItems:(null==e?void 0:e.maxItems)||S,maxAttempts:(null==e?void 0:e.maxAttempts)||_,maxRetryDelay:(null==e?void 0:e.maxRetryDelay)||A,minRetryDelay:(null==e?void 0:e.minRetryDelay)||D}}}})),n.register("lzLew",(function(r,s){e(r.exports,"default",(()=>f));var i=n("8ymt6"),o=n("fWyjG"),a=n("4uXgr"),c=n("c2D3i");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function l(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?u(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):u(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const d=e=>new Promise((t=>{setTimeout(t,e)})),h=async(e,t)=>{const{queue:r,inProgress:s}=e.storageKeys,i=JSON.parse(localStorage.getItem(r)||"[]"),n=JSON.parse(localStorage.getItem(s)||"{}"),o=[...i,...Object.entries(n).map((([e,t])=>l(l({},t),{},{attemptNumber:t.attemptNumber+1,id:e})))];if(o.length>0){const i=await t(o);if("successful"===i.status)p(e.storageKeys);else if("partial"===i.status){const e=o.filter((e=>!i.acceptedItemIds.includes(e.id)));return localStorage.removeItem(s),localStorage.setItem(r,JSON.stringify(e)),{fullReclaim:!1}}}else p(e.storageKeys);return{fullReclaim:!0}},p=e=>{localStorage.removeItem(e.queue),localStorage.removeItem(e.inProgress),localStorage.removeItem(e.reclaimEnd),localStorage.removeItem(e.reclaimStart),localStorage.removeItem(e.ack)};var f=async(e,r)=>{if("string"!=typeof e||0===e.length)return{fullReclaims:0,partialReclaims:0,failedReclaims:0};const s=t(o)(),i=(e=>{try{return Object.keys(localStorage).filter((t=>t.startsWith(e))).map((e=>e.split("."))).filter((t=>{if(3===t.length&&t[0]===e&&t[2]===a.LocalStorageKeySuffix.ACK)try{const e=localStorage.getItem(t.join("."));if(e){const t=parseInt(e);return a.Timers.RECLAIM_TIMEOUT+t<Date.now()}}catch(e){}return!1})).map((e=>e[1]))}catch(e){}return[]})(e),n=i.map((t=>(async(e,t)=>{const{ack:r,reclaimStart:s,reclaimEnd:i}=e.storageKeys,n=Date.now();if(localStorage.setItem(s,e.reclaimProcessId),localStorage.setItem(r,n.toString()),await d(a.Timers.RECLAIM_WAIT),Date.now()>n+a.Timers.RECLAIM_WAIT_THRESHOLD||localStorage.getItem(s)!==e.reclaimProcessId)throw new Error("Took to long to callback, reclaim abandonded. After reclaimStart.");if(localStorage.setItem(i,e.reclaimProcessId),await d(a.Timers.RECLAIM_WAIT),Date.now()>n+a.Timers.RECLAIM_WAIT_THRESHOLD||localStorage.getItem(s)!==e.reclaimProcessId||localStorage.getItem(i)!==e.reclaimProcessId)throw new Error("Took to long to callback, reclaim abandonded. After reclaimEnd.");return h(e,t)})({queuePrefix:e,reclaimProcessId:s,storageKeys:(0,c.createLocalStorageKeys)(e,t)},r))),u=await Promise.allSettled(n),l=u.filter((e=>"rejected"===e.status)),p=u.filter((e=>"fulfilled"===e.status)).map((e=>e.value)),f=p.filter((e=>e.fullReclaim)),m=p.filter((e=>!e.fullReclaim));return{failedReclaims:l.length,partialReclaims:m.length,fullReclaims:f.length}}})),n.register("4uXgr",(function(t,r){let s;var i;let n;var o;e(t.exports,"LocalStorageKeySuffix",(()=>s)),e(t.exports,"Timers",(()=>n)),(i=s||(s={})).IN_PROGRESS="inProgress",i.QUEUE="queue",i.RECLAIM_START="reclaimStart",i.RECLAIM_END="reclaimEnd",i.ACK="ack",(o=n||(n={}))[o.RECLAIM_TIMEOUT=1e4]="RECLAIM_TIMEOUT",o[o.RECLAIM_WAIT=500]="RECLAIM_WAIT",o[o.RECLAIM_WAIT_THRESHOLD=2e3]="RECLAIM_WAIT_THRESHOLD"})),n.register("c2D3i",(function(t,r){e(t.exports,"createLocalStorageKeys",(()=>i));var s=n("4uXgr");const i=(e,t)=>({[s.LocalStorageKeySuffix.ACK]:`${e}.${t}.${s.LocalStorageKeySuffix.ACK}`,[s.LocalStorageKeySuffix.QUEUE]:`${e}.${t}.${s.LocalStorageKeySuffix.QUEUE}`,[s.LocalStorageKeySuffix.IN_PROGRESS]:`${e}.${t}.${s.LocalStorageKeySuffix.IN_PROGRESS}`,[s.LocalStorageKeySuffix.RECLAIM_START]:`${e}.${t}.${s.LocalStorageKeySuffix.RECLAIM_START}`,[s.LocalStorageKeySuffix.RECLAIM_END]:`${e}.${t}.${s.LocalStorageKeySuffix.RECLAIM_END}`})})),n.register("apnBy",(function(t,r){e(t.exports,"default",(()=>a));var s=n("4uXgr"),i=n("c2D3i");const o=Object.values(s.LocalStorageKeySuffix);var a=e=>{if("string"!=typeof e||0===e.length)return 0;try{const t=Object.keys(localStorage).filter((t=>t&&t.startsWith(`${e}.`)||!1)).map((e=>e.split("."))).filter((e=>3===e.length&&o.includes(e[2]))).reduce(((e,t)=>{const[,r,s]=t;return void 0===e[r]&&(e[r]={}),e[r][s]=!0,e}),{}),r=Object.keys(t).filter((e=>!0!==t[e][s.LocalStorageKeySuffix.ACK]));return r.forEach((t=>{const{queue:r,inProgress:s,reclaimStart:n,reclaimEnd:o}=(0,i.createLocalStorageKeys)(e,t);localStorage.removeItem(s),localStorage.removeItem(r),localStorage.removeItem(n),localStorage.removeItem(o)})),r.length}catch(e){}return 0}})),n.register("eXTDJ",(function(t,r){e(t.exports,"default",(()=>i)),e(t.exports,"GuardPolicy",(()=>n("jnNAC").GuardPolicy)),e(t.exports,"CallbackProcessingErrorName",(()=>n("4rlmz").CallbackProcessingErrorName));var s=n("3O9eV"),i=(n("jnNAC"),n("4rlmz"),s.default)})),n.register("3O9eV",(function(t,r){e(t.exports,"default",(()=>l));var s=n("jnNAC"),i=n("jvYEo"),o=n("jvzET"),a=n("fwrWA"),c=n("gRs2i"),u=n("6DqIi");class l{constructor(e,t={}){if(this.namespace=e,this.options=(0,u.createOptionsWithDefaults)(t),!e||0===e.length||"string"!=typeof e)throw new Error("Invalid namespace provided");this.resilience=this.getResilienceMechanism(e,t)}getResilienceMechanism(e,t){if(!t.useMemory)try{return new(0,a.default)(e,t)}catch(e){var r;if(!(e instanceof i.default))null===(r=t.logger)||void 0===r||r.warn("Attempted to create IndexedDbResilience but failed. Using memory instead.")}return new(0,c.default)(this.namespace,t)}addItem(e,t,r=s.GuardPolicy.ABANDON){return this.runOrFailOver((()=>this.resilience.addItem(e,t,r)))}bulkAddItem(e,t=s.GuardPolicy.ABANDON){return this.runOrFailOver((()=>this.resilience.bulkAddItem(e,t)))}getItems(e){return this.runOrFailOver((()=>this.resilience.getItems(e)))}deleteItems(e){return this.runOrFailOver((()=>this.resilience.deleteItems(e)))}getItemCount(){return this.runOrFailOver((()=>this.resilience.getItemCount()))}processItems(e,t){return this.runOrFailOver((()=>this.resilience.processItems(e,t)))}storeType(){return this.resilience.storeType()}async runOrFailOver(e){try{return await e()}catch(t){if((0,o.shouldIgnoreResilienceDbError)(t))throw t;return this.resilience.storeType()===s.StoreType.INDEXEDDB&&await this.failOver(),e()}}async failOver(){const e=this.resilience,t=new(0,c.default)(this.namespace,this.options);this.resilience=t;try{const{items:r}=await e.getItems(this.options.maxEventLimit);if(r.length>0){const i=(await t.bulkAddItemWrapperType(r,s.GuardPolicy.IGNORE)).items.map((e=>e.id));await e.deleteItems(i)}}catch(e){this.options.logger.warn("Unexpected error from ResilienceDb, switching to MemoryDb")}}}})),n.register("jnNAC",(function(t,r){e(t.exports,"NAMESPACE_AND_TIME_ADDED_INDEX",(()=>s)),e(t.exports,"RESILIENCE_DB_NAME",(()=>i)),e(t.exports,"RESILIENCE_STORE_NAME",(()=>n)),e(t.exports,"TIME_TO_PROCESS_AFTER_INDEX",(()=>o)),e(t.exports,"TIME_ADDED_INDEX",(()=>a)),e(t.exports,"RETRY_INDEX",(()=>c)),e(t.exports,"INDEXEDDB_TIMEOUT",(()=>u)),e(t.exports,"StoreType",(()=>l)),e(t.exports,"GuardPolicy",(()=>h));const s="namespace-timeAdded",i="analytics-web-client",n="analytics-resilience",o="timeToBeProcessedAfter",a="timeAdded",c="retryAttempts",u=15e3;let l;var d;let h;var p;(d=l||(l={})).INDEXEDDB="indexeddb",d.MEMORY="memory",(p=h||(h={})).IGNORE="ignore",p.ABANDON="abandon",p.EVICT="evict"})),n.register("d1ReJ",(function(t,r){e(t.exports,"AbandonWriteErrorName",(()=>s)),e(t.exports,"default",(()=>i));const s="AbandonWriteError";class i extends Error{constructor(e){super(`Event Limit reached. Abandoning write to: ${e}`),Object.setPrototypeOf(this,i.prototype),this.name=s}}})),n.register("4rlmz",(function(t,r){e(t.exports,"CallbackProcessingErrorName",(()=>s)),e(t.exports,"default",(()=>i));const s="CallbackProcessingError";class i extends Error{constructor(e){super(`Error thrown while processing events in callback: ${e&&"object"==typeof e&&"toString"in e&&"function"==typeof e.toString&&e.toString()||"string"==typeof e&&e||"Argument passed to CallbackProcessingError was not an Error or string."}`),Object.setPrototypeOf(this,i.prototype),this.name=s}}})),n.register("7AfLH",(function(t,r){e(t.exports,"InvalidPolicyErrorName",(()=>s)),e(t.exports,"default",(()=>i));const s="InvalidPolicyError";class i extends Error{constructor(e,t){super(`Method '${t}' cannot be called with policy '${e}'.`),this.name=s}}})),n.register("jvYEo",(function(t,r){e(t.exports,"default",(()=>s));class s extends Error{constructor(){super("window.indexeddb is undefined."),Object.setPrototypeOf(this,s.prototype),this.name="NoIndexedDbError"}}})),n.register("jvzET",(function(t,r){e(t.exports,"shouldIgnoreResilienceDbError",(()=>a));var s=n("d1ReJ"),i=n("4rlmz"),o=n("7AfLH");const a=e=>{if(e&&"object"==typeof e&&"name"in e){const t=e;return"string"==typeof t.name&&(t.name===s.AbandonWriteErrorName||t.name===i.CallbackProcessingErrorName||t.name===o.InvalidPolicyErrorName)}return!1}})),n.register("fwrWA",(function(r,s){e(r.exports,"default",(()=>v));var i=n("hqAz3"),o=n("8ymt6"),a=n("jnNAC"),c=n("fwAQi"),u=n("jvYEo"),l=n("7AfLH"),d=n("jvzET"),h=n("4rlmz"),p=n("9qlrl"),f=n("6DqIi");const m=["item"],g=["items"];function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}class v{constructor(e,r={}){if(t(o)(this,"startDB",(async()=>new Promise((async(e,t)=>{window.setTimeout((()=>{this.logger.warn("IndexedDB timed out."),t(new(0,u.default))}),a.INDEXEDDB_TIMEOUT);const r=window.indexedDB.open(a.RESILIENCE_DB_NAME,1);r.onupgradeneeded=e=>{if(0!==e.oldVersion)throw new Error("We cannot upgrade the database. Do not do this.");const t=r.result.createObjectStore(a.RESILIENCE_STORE_NAME,{keyPath:"id"});t.createIndex(a.TIME_TO_PROCESS_AFTER_INDEX,a.TIME_TO_PROCESS_AFTER_INDEX,{unique:!1}),t.createIndex(a.RETRY_INDEX,a.RETRY_INDEX,{unique:!1}),t.createIndex(a.TIME_ADDED_INDEX,a.TIME_ADDED_INDEX,{unique:!1}),t.createIndex(a.NAMESPACE_AND_TIME_ADDED_INDEX,["namespace","timeAdded"],{unique:!1})};try{return await(0,f.requestToPromise)(r),e(r.result)}catch(e){this.logger.warn("IndexedDB failed to initialise.",e),t(new(0,u.default))}})))),t(o)(this,"addItem",(async(e,t={},r=a.GuardPolicy.ABANDON)=>{const{logger:s,namespace:i}=this,n=(0,f.convertToItemWrapper)(e,i,t),{objectStore:o}=await this.getObjectStoreAndTransaction("readwrite");if(r===a.GuardPolicy.IGNORE)throw new(0,l.default)(r,"IndexedDbConnector#addItem");try{if(!n.namespace||0===n.namespace.length||"string"!=typeof n.namespace)throw new Error("Namespace not specified");const e=await this.globalEventLimitGuard.insertItems(o,[n],r);if(1===e.items.length)return{item:e.items[0],numberOfEvictedItems:e.numberOfEvictedItems};throw new Error(`Incorrect number of items added. Expected: 1, got: ${e.items.length}`)}catch(e){if((0,d.shouldIgnoreResilienceDbError)(e))throw e;throw s.log("Failed to add item to table",e),new Error("Request to add item to table failed")}})),t(o)(this,"bulkAddItem",(async(e,r=a.GuardPolicy.ABANDON)=>{const{logger:s,namespace:n}=this,o=e.map((e=>{let{item:r}=e,s=t(i)(e,m);return(0,f.convertToItemWrapper)(r,n,s)})),{objectStore:c}=await this.getObjectStoreAndTransaction("readwrite");try{return await this.globalEventLimitGuard.insertItems(c,o,r)}catch(e){if((0,d.shouldIgnoreResilienceDbError)(e))throw e;throw s.log("Failed to add item to table",e),new Error("Request to add item to table failed")}})),t(o)(this,"getItems",(async(e=c.GET_ITEM_COUNT)=>{const r=e>0?e:c.GET_ITEM_COUNT,{logger:s}=this,i=this.options.maxAttempts,{transaction:n,objectStore:u}=await this.getObjectStoreAndTransaction("readwrite"),l=u.index(a.TIME_TO_PROCESS_AFTER_INDEX),d=IDBKeyRange.upperBound(Date.now()),h=l.openCursor(d),p=await new Promise((async(e,n)=>{const a=[];let u=0;h.onerror=e=>{s.error("Failed to open cursor:",e),n("Failed to open cursor")},h.onsuccess=n=>{const l=n.target.result;if(l){const n=function(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?y(Object(s),!0).forEach((function(r){t(o)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):y(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({},l.value);a.push(n);const d=l.value;if(d.retryAttempts+=1,d.timeToBeProcessedAfter=Date.now()+c.VISIBILITY_TIMEOUT,d.retryAttempts>=i){++u;const e=l.delete();(0,f.monitorErrorsOnRequest)(e,s)}else{const e=l.update(d);(0,f.monitorErrorsOnRequest)(e,s)}a.length<r?l.continue():e({items:a,numberOfDeletedItems:u})}else e({items:a,numberOfDeletedItems:u})}}));return await(0,f.commitTransaction)(n,this.logger),p})),t(o)(this,"deleteItems",(async e=>{const{transaction:t,objectStore:r}=await this.getObjectStoreAndTransaction("readwrite");try{const s=e.map((e=>this.deleteItem(r,e)));await(0,f.commitTransaction)(t,this.logger),await Promise.all(s)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}})),t(o)(this,"getItemCount",(async()=>{const{transaction:e,objectStore:t}=await this.getObjectStoreAndTransaction("readonly"),r=t.index(a.TIME_TO_PROCESS_AFTER_INDEX),s=IDBKeyRange.upperBound(Date.now()),i=r.count(s),n=await(0,f.requestToPromise)(i);return await(0,f.commitTransaction)(e,this.logger),n.target.result})),t(o)(this,"processItems",(async(e,r=c.GET_ITEM_COUNT)=>{const s=await this.getItems(r),{items:n}=s,o=t(i)(s,g);try{const t=await e(n,o),r=n.map((e=>e.id));return await this.deleteItems(r),t}catch(e){throw new(0,h.default)(e)}})),t(o)(this,"deleteItem",(async(e,t)=>{const{logger:r}=this;try{await(0,f.requestToPromise)(e.delete(t))}catch(e){throw r.error("Failed to delete item:",t,e),e}})),t(o)(this,"getObjectStoreAndTransaction",(async e=>{const t=(await this.db).transaction(a.RESILIENCE_STORE_NAME,e),r=t.objectStore(a.RESILIENCE_STORE_NAME);return{transaction:t,objectStore:r}})),this.options=(0,f.createOptionsWithDefaults)(r),this.namespace=e,this.logger=this.options.logger,!window.indexedDB)throw new(0,u.default);this.db=this.startDB(),this.db.catch((()=>{})),this.globalEventLimitGuard=new(0,p.default)(this.options.maxEventLimit,this.namespace,this.logger,this.deleteItem)}storeType(){return a.StoreType.INDEXEDDB}}})),n.register("hqAz3",(function(e,t){var r=n("7Futg");e.exports=function(e,t){if(null==e)return{};var s,i,n=r(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)s=o[i],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n},e.exports.__esModule=!0,e.exports.default=e.exports})),n.register("7Futg",(function(e,t){e.exports=function(e,t){if(null==e)return{};var r,s,i={},n=Object.keys(e);for(s=0;s<n.length;s++)r=n[s],t.indexOf(r)>=0||(i[r]=e[r]);return i},e.exports.__esModule=!0,e.exports.default=e.exports})),n.register("fwAQi",(function(t,r){e(t.exports,"GET_ITEM_COUNT",(()=>s)),e(t.exports,"VISIBILITY_TIMEOUT",(()=>i)),e(t.exports,"MAX_ATTEMPTS",(()=>n)),e(t.exports,"EVENT_COUNT_LIMIT",(()=>o));const s=7,i=6e4,n=10,o=5e3})),n.register("9qlrl",(function(r,s){e(r.exports,"default",(()=>u));var i=n("8ymt6"),o=n("jnNAC"),a=n("d1ReJ"),c=n("6DqIi");class u{constructor(e,r,s,n){if(t(i)(this,"deleteOldestNEvents",(async(e,t)=>{var r;const s=e.index(o.NAMESPACE_AND_TIME_ADDED_INDEX),i=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),n=s.getAllKeys(i,t),a=await(0,c.requestToPromise)(n),u=null==a||null===(r=a.target)||void 0===r?void 0:r.result;if(u&&Array.isArray(u)&&u.length>0)try{const t=u.map((t=>this.deleteItemHandler(e,t)));await Promise.all(t)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}})),!(e>0))throw Error("Event Limit has to be set higher than 1");this.eventLimit=e,this.namespace=r,this.logger=s,this.deleteItemHandler=n}async insertItems(e,t,r=o.GuardPolicy.ABANDON){const s=[...t];let i=0;switch(r){case o.GuardPolicy.ABANDON:await this.throwIfNotEnoughSpace(e,t.length);break;case o.GuardPolicy.EVICT:i=await this.evictIfNotEnoughSpace(e,t.length);break;case o.GuardPolicy.IGNORE:await this.calculateHowManyEventsWeCanAdd(e,s)}const n=s.map((t=>(0,c.requestToPromise)(e.add(t))));return await Promise.all(n),await(0,c.commitTransaction)(e.transaction,this.logger),{items:s,numberOfEvictedItems:i}}async throwIfNotEnoughSpace(e,t){const r=await this.calculateFreeSpace(e);if(r<t)throw new(0,a.default)(`Not enough space in IndexedDb. Needed ${t} but only had ${r}`)}async evictIfNotEnoughSpace(e,t){const r=await this.calculateFreeSpace(e);if(r<t){const s=t-r;return await this.deleteOldestNEvents(e,s),s}return 0}async calculateHowManyEventsWeCanAdd(e,t){const r=await this.calculateFreeSpace(e);if(r<t.length){const e=t.length-r,s=t.length-e;t.splice(s,e)}}async calculateFreeSpace(e){const t=await this.getCountofEventsInObjectStore(e);return this.eventLimit-t}async getCountofEventsInObjectStore(e){const t=e.index(o.NAMESPACE_AND_TIME_ADDED_INDEX),r=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),s=t.count(r);return(await(0,c.requestToPromise)(s)).target.result}}})),n.register("6DqIi",(function(r,s){e(r.exports,"convertToItemWrapper",(()=>a)),e(r.exports,"createOptionsWithDefaults",(()=>c)),e(r.exports,"requestToPromise",(()=>u)),e(r.exports,"commitTransaction",(()=>l)),e(r.exports,"monitorErrorsOnRequest",(()=>d));var i=n("fWyjG"),o=n("fwAQi");const a=(e,r,{id:s,retryAttempts:n,timeToProcessOffset:o})=>({item:e,id:s||t(i)(),retryAttempts:n||0,timeToBeProcessedAfter:Date.now()+(o||0),namespace:r,timeAdded:Date.now()}),c=e=>({logger:e.logger||console,useMemory:e.useMemory||!1,maxAttempts:e.maxAttempts||o.MAX_ATTEMPTS,maxEventLimit:e.maxEventLimit||o.EVENT_COUNT_LIMIT}),u=e=>new Promise(((t,r)=>{e.onsuccess=e=>{t(e)},e.onerror=e=>{r(e)}})),l=(e,t)=>{try{"function"==typeof e.commit&&e.commit()}catch(e){throw t.error("Failed to force commit transaction:",e),e}return(e=>new Promise(((t,r)=>{e.oncomplete=()=>{t()},e.onerror=e=>{r(e)},e.onabort=e=>{r(e)}})))(e)},d=(e,t)=>{e.onerror=e=>{t.warn("Error thrown from request:",e)}}})),n.register("gRs2i",(function(r,s){e(r.exports,"default",(()=>y));var i=n("8ymt6"),o=n("hqAz3"),a=n("jnNAC"),c=n("fwAQi"),u=n("7AfLH"),l=n("4rlmz"),d=n("hLpL9"),h=n("6DqIi");const p=["item"],f=["items"];function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function g(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?m(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):m(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class y{constructor(e,t={}){this.namespace=e,this.memoryStore=[],this.options=(0,h.createOptionsWithDefaults)(t),this.globalEventLimitGuard=new(0,d.default)(this.options.maxEventLimit,{addItems:this.addItems.bind(this),getItemCount:this.getItemCount.bind(this),evictEventsIfNeeded:this.evictEventsIfNeeded.bind(this)})}async addItem(e,t={},r=a.GuardPolicy.ABANDON){if(r===a.GuardPolicy.IGNORE)throw new(0,u.default)(r,"IndexedDbConnector#addItem");const s=(0,h.convertToItemWrapper)(e,this.namespace,t),i=await this.globalEventLimitGuard.insertItemsToMemoryStore([s],r);return Promise.resolve({item:i.items[0],numberOfEvictedItems:i.numberOfEvictedItems})}bulkAddItem(e,r=a.GuardPolicy.ABANDON){const s=e.map((e=>{let{item:r}=e,s=t(o)(e,p);return(0,h.convertToItemWrapper)(r,this.namespace,s)}));return this.bulkAddItemWrapperType(s,r)}bulkAddItemWrapperType(e,t=a.GuardPolicy.ABANDON){return Promise.resolve(this.globalEventLimitGuard.insertItemsToMemoryStore(e,t))}getItems(e=c.GET_ITEM_COUNT){return Promise.resolve(this.synchronousGetItems(e))}synchronousGetItems(e=c.GET_ITEM_COUNT){const t=e>0?e:c.GET_ITEM_COUNT,r=Date.now(),s=[],i=[];for(let e of this.memoryStore)if(e.timeToBeProcessedAfter<=r&&(s.push(g({},e)),e.timeToBeProcessedAfter+=c.VISIBILITY_TIMEOUT,e.retryAttempts+=1,e.retryAttempts>=this.options.maxAttempts&&i.push(e)),s.length>=t)break;return i.forEach((e=>{const t=this.memoryStore.indexOf(e);this.memoryStore.splice(t,1)})),{items:s,numberOfDeletedItems:i.length}}deleteItems(e){return this.memoryStore=this.memoryStore.filter((t=>!e.includes(t.id))),Promise.resolve(void 0)}getItemCount(){const e=Date.now(),t=this.memoryStore.filter((t=>t.timeToBeProcessedAfter<=e)).length;return Promise.resolve(t)}async processItems(e,r){const s=this.synchronousGetItems(r),{items:i}=s,n=t(o)(s,f),a=i.map((e=>e.id));try{const t=await e(i,n);return await this.deleteItems(a),t}catch(e){throw new(0,l.default)(e)}}storeType(){return a.StoreType.MEMORY}addItems(e){this.memoryStore.push(...e),this.memoryStore.sort((function(e,t){return e.timeAdded-t.timeAdded}))}evictEventsIfNeeded(e){const t=this.memoryStore.length;if(t>e){const r=t-e;return this.memoryStore.splice(0,r),r}return 0}}})),n.register("hLpL9",(function(r,s){e(r.exports,"default",(()=>c));var i=n("8ymt6"),o=n("jnNAC"),a=n("d1ReJ");class c{constructor(e,r){if(t(i)(this,"insertItemsToMemoryStore",((e,t)=>{switch(t){case o.GuardPolicy.ABANDON:return this.handleAbandonIfLimitWillExceedPolicy(e);case o.GuardPolicy.EVICT:return Promise.resolve(this.handleEvictOldestIfLimitExceededPolicy(e));case o.GuardPolicy.IGNORE:return this.handleAddAsManyAsPossible(e)}})),!(e>0))throw Error("Event Limit has to be set higher than 1");this.eventLimit=e,this.memoryItemHandlers=r}async handleAbandonIfLimitWillExceedPolicy(e){if(await this.memoryItemHandlers.getItemCount()+e.length>this.eventLimit)throw new(0,a.default)(o.StoreType.MEMORY);return this.memoryItemHandlers.addItems(e),{items:e,numberOfEvictedItems:0}}handleEvictOldestIfLimitExceededPolicy(e){this.memoryItemHandlers.addItems(e);return{items:e,numberOfEvictedItems:this.memoryItemHandlers.evictEventsIfNeeded(this.eventLimit)}}async handleAddAsManyAsPossible(e){const t=this.eventLimit-await this.memoryItemHandlers.getItemCount(),r=t>e.length?e:e.slice(0,t);return this.memoryItemHandlers.addItems(r),{items:r,numberOfEvictedItems:0}}}})),n.register("jJOAQ",(function(r,s){e(r.exports,"default",(()=>u));var i=n("8ymt6"),o=n("jZuTq");class a{constructor(){t(i)(this,"itemsDiscardedByRetry",0),t(i)(this,"eventCount",0),t(i)(this,"itemsDiscardedByOverflow",0),t(i)(this,"resilienceMechanism",o.ResilienceMechanism.INDEXEDDB),t(i)(this,"localstorageNumberOfQueuesPurged",0),t(i)(this,"localstorageNumberOfFullReclaims",0),t(i)(this,"localstorageNumberOfPartialReclaims",0),t(i)(this,"localstorageNumberOfFailedReclaims",0)}addToItemsDiscardedByRetryCounter(e=1){this.itemsDiscardedByRetry+=e}addToEventCount(){this.eventCount++}addToItemsDiscardedByOverflowCounter(e=1){this.itemsDiscardedByOverflow+=e}setResilienceMechanism(e){this.resilienceMechanism=e}addToReclaimMetrics(e){this.localstorageNumberOfFullReclaims+=e.fullReclaims,this.localstorageNumberOfPartialReclaims+=e.partialReclaims,this.localstorageNumberOfFailedReclaims+=e.failedReclaims}addToPurgedQueuesMetrics(e){this.localstorageNumberOfQueuesPurged+=e}subtractFromMetrics(e){this.itemsDiscardedByRetry=this.subtractFromCount(this.itemsDiscardedByRetry,e.itemsDiscardedByRetry),this.eventCount=this.subtractFromCount(this.eventCount,e.eventCount),this.itemsDiscardedByOverflow=this.subtractFromCount(this.itemsDiscardedByOverflow,e.itemsDiscardedByOverflow),this.localstorageNumberOfFullReclaims=this.subtractFromCount(this.localstorageNumberOfFullReclaims,e.fullReclaims),this.localstorageNumberOfPartialReclaims=this.subtractFromCount(this.localstorageNumberOfPartialReclaims,e.partialReclaims),this.localstorageNumberOfFailedReclaims=this.subtractFromCount(this.localstorageNumberOfFailedReclaims,e.failedReclaims),this.localstorageNumberOfQueuesPurged=this.subtractFromCount(this.localstorageNumberOfQueuesPurged,e.localstorageQueuesPurged)}subtractFromCount(e,t){return Math.max(e-(t||0),0)}getMetricsPayload(){return{itemsDiscardedByRetry:this.itemsDiscardedByRetry,eventCount:this.eventCount,itemsDiscardedByOverflow:this.itemsDiscardedByOverflow,resilienceMechanism:this.resilienceMechanism,localstorageQueuesPurged:this.localstorageNumberOfQueuesPurged,fullReclaims:this.localstorageNumberOfFullReclaims,partialReclaims:this.localstorageNumberOfPartialReclaims,failedReclaims:this.localstorageNumberOfFailedReclaims}}}let c=null;var u=()=>(c||(c=new a),c)})),n.register("jZuTq",(function(t,r){let s;var i;let n;var o;e(t.exports,"ResilienceMechanism",(()=>s)),e(t.exports,"NetworkStatusEnum",(()=>n)),(i=s||(s={})).INDEXEDDB="indexeddb",i.MEMORY="memory",(o=n||(n={}))[o.ONLINE=0]="ONLINE",o[o.OFFLINE=1]="OFFLINE"})),n.register("iH1Zw",(function(t,r){e(t.exports,"default",(()=>i));var s=n("jZuTq");class i{constructor(e){window.addEventListener("offline",(()=>e(s.NetworkStatusEnum.OFFLINE))),window.addEventListener("online",(()=>e(s.NetworkStatusEnum.ONLINE)))}getNetworkStatus(){return window.navigator.onLine?s.NetworkStatusEnum.ONLINE:s.NetworkStatusEnum.OFFLINE}}})),n.register("eOVWY",(function(r,s){e(r.exports,"default",(()=>g));var i=n("8ymt6"),o=n("kmVeJ"),a=n("faIK1");const c=1e3,u=3e4,l=2,d=0,h=500,p=5e3;let f;var m;(m=f||(f={}))[m.NONE=0]="NONE",m[m.IMMEDIATE=1]="IMMEDIATE",m[m.WAIT=2]="WAIT";class g{constructor(e,r){t(i)(this,"schedule",(({immediate:e}={immediate:!1})=>{this.operationInFlight?e?this.queuedSchedule=f.IMMEDIATE:this.queuedSchedule!==f.IMMEDIATE&&(this.queuedSchedule=f.WAIT):(e||this.options.waitInterval<=0)&&0===this.failureCount?(this.clearTimeout(),this.run()):this.failureCount>0&&null===this.scheduledTimeout?this.scheduledTimeout=window.setTimeout(this.run,this.calculateBackoff()):null===this.scheduledTimeout&&(this.scheduledTimeout=window.setTimeout(this.run,this.options.waitInterval))})),t(i)(this,"stop",(()=>{this.clearTimeout(),this.queuedSchedule=f.NONE})),t(i)(this,"getFailureCount",(()=>this.failureCount)),t(i)(this,"getCallbackStatus",(()=>this.callbackTimer.getCallbackStatus())),t(i)(this,"clearTimeout",(()=>{null!==this.scheduledTimeout&&(window.clearTimeout(this.scheduledTimeout),this.scheduledTimeout=null)})),t(i)(this,"run",(()=>{this.operationInFlight=!0,this.clearTimeout();try{this.callbackTimer.executeCallbackWithTimeout(this.callback,this.done,(()=>this.done(a.DoneState.ERROR)))}catch(e){this.done(e)}})),t(i)(this,"done",(e=>{this.operationInFlight=!1,e===a.DoneState.ERROR||this.callbackTimer.getCallbackStatus()===o.CallbackStatus.TIMED_OUT?(this.failureCount++,this.clearTimeout()):e===a.DoneState.SUCCESS&&(this.failureCount=0),this.processQueuedSchedule()})),t(i)(this,"processQueuedSchedule",(()=>{if(this.queuedSchedule!==f.NONE){const e=this.queuedSchedule===f.IMMEDIATE;this.queuedSchedule=f.NONE,this.schedule({immediate:e})}else this.failureCount>0&&this.schedule()})),t(i)(this,"calculateBackoff",(()=>{const{minRetryDelay:e,maxRetryDelay:t,backoffFactor:r,backoffJitterPercentage:s}=this.options;let i=e*r**this.failureCount;if(s){const e=Math.random(),t=Math.floor(e*s*i);Math.floor(10*e)<5?i-=t:i+=t}return Number(Math.min(i,t).toPrecision(1))})),this.options={minRetryDelay:e.minRetryDelay||c,maxRetryDelay:e.maxRetryDelay||u,backoffFactor:e.backoffFactor||l,backoffJitterPercentage:e.backoffJitterPercentage||d,waitInterval:void 0!==e.waitInterval?e.waitInterval:h,callbackTimeoutPeriod:e.callbackTimeoutPeriod||p},this.scheduledTimeout=null,this.failureCount=0,this.callback=r,this.operationInFlight=!1,this.queuedSchedule=f.NONE,this.callbackTimer=new(0,o.CallbackWithTimeout)(this.options.callbackTimeoutPeriod)}}})),n.register("kmVeJ",(function(r,s){e(r.exports,"CallbackStatus",(()=>o)),e(r.exports,"CallbackWithTimeout",(()=>l));var i=n("8ymt6");let o;var a;let c;var u;(a=o||(o={})).IDLE="idle",a.RUNNING="running",a.COMPLETED="completed",a.TIMED_OUT="timedOut",(u=c||(c={})).EXECUTE="execute",u.COMPLETE="complete",u.TIMEOUT="timeout";class l{constructor(e){if(t(i)(this,"timeoutHandle",void 0),t(i)(this,"callbackStatus",o.IDLE),!(e>0))throw new Error("CallbackWithTimeout requires timeout period higher than 0");this.timeoutPeriod=e}transitionCallbackStatus(e,t){switch(e){case o.IDLE:case o.TIMED_OUT:case o.COMPLETED:t===c.EXECUTE&&(this.callbackStatus=o.RUNNING);break;case o.RUNNING:switch(t){case c.COMPLETE:this.callbackStatus=o.COMPLETED;break;case c.TIMEOUT:this.callbackStatus=o.TIMED_OUT}break;default:this.callbackStatus=e}}executeCallbackWithTimeout(e,t,r){this.transitionCallbackStatus(this.callbackStatus,c.EXECUTE),this.timeoutHandle=window.setTimeout((()=>{this.transitionCallbackStatus(this.callbackStatus,c.TIMEOUT),r()}),this.timeoutPeriod),e((e=>{this.cancelTimeout(),this.getCallbackStatus()!==o.TIMED_OUT&&(this.transitionCallbackStatus(this.callbackStatus,c.COMPLETE),t(e))}))}getCallbackStatus(){return this.callbackStatus}cancelTimeout(){this.timeoutPeriod>0&&this.timeoutHandle&&(window.clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0)}}})),n.register("faIK1",(function(t,r){let s;var i;e(t.exports,"DoneState",(()=>s)),(i=s||(s={}))[i.NOOP=0]="NOOP",i[i.SUCCESS=1]="SUCCESS",i[i.ERROR=2]="ERROR"})),n.register("k4ZbT",(function(t,r){e(t.exports,"XIDPromise",(()=>i));var s=n("985WQ");const i=(e,t)=>{if(e&&t&&"function"==typeof t){const e=()=>new Promise((e=>{setTimeout((()=>e((()=>(0,s.createTimeoutXid)()))),s.XID_TIMEOUT)})),r=()=>t().catch((()=>()=>(0,s.createUnknownXid)()));return Promise.race([r(),e()])}}})),n.register("985WQ",(function(t,r){e(t.exports,"XID_TIMEOUT",(()=>i)),e(t.exports,"createTimeoutXid",(()=>o)),e(t.exports,"createUnknownXid",(()=>a));var s=n("iSJ4i");const i=5e3,o=()=>[{type:s.XIDItemType.XC,state:"TIMEOUT"},{type:s.XIDItemType.UID,state:"TIMEOUT"}],a=()=>[{type:s.XIDItemType.XC,state:"UNKNOWN"},{type:s.XIDItemType.UID,state:"UNKNOWN"}]})),n.register("iSJ4i",(function(t,r){let s;var i;let n;var o;e(t.exports,"XIDItemType",(()=>s)),(i=s||(s={})).XC="xc",i.UID="uid",(o=n||(n={})).NEW="NEW",o.CHANGED="CHANGED",o.EXISTING="EXISTING",o.TIMEOUT="TIMEOUT",o.ERROR="ERROR",o.UNAVAILABLE="UNAVAILABLE",o.MALFORMED="MALFORMED",o.UNKNOWN="UNKNOWN"})),n.register("aDDvw",(function(r,s){e(r.exports,"attachXidToMultipleEvents",(()=>u));var i=n("8ymt6"),o=n("25Iz6");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?a(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}async function u(e,t){try{const r=await t;return e.map((e=>function(e,t){if(!(t&&t instanceof Function))return e;if(e.msg.type===o.SegmentEventTypes.PAGE||e.msg.type===o.SegmentEventTypes.TRACK){const r=t();r&&Array.isArray(r)&&(e.msg.properties=c(c({},e.msg.properties),{},{xid:r}))}else if(e.msg.traits&&e.msg.type===o.SegmentEventTypes.IDENTIFY){const r=t();r&&Array.isArray(r)&&(e.msg.traits=c(c({},e.msg.traits),{},{xid:r}))}return e}(e,r)))}catch(t){return e}}})),n.register("25Iz6",(function(t,r){let s;var i;let n;var o;let a;var c;e(t.exports,"SegmentEventTypes",(()=>s)),(i=s||(s={})).IDENTIFY="identify",i.PAGE="page",i.TRACK="track",(o=n||(n={})).XC="xc",o.UID="uid",(c=a||(a={})).NEW="NEW",c.CHANGED="CHANGED",c.EXISTING="EXISTING",c.TIMEOUT="TIMEOUT",c.ERROR="ERROR",c.UNAVAILABLE="UNAVAILABLE",c.MALFORMED="MALFORMED",c.UNKNOWN="UNKNOWN"})),n.register("1I6pE",(function(t,r){e(t.exports,"DEFAULT_REQUEST_TIMEOUT",(()=>s));const s=1e4})),n.register("j9VsO",(function(r,s){e(r.exports,"sendEvents",(()=>c));var i=n("8ymt6"),o=n("6O0C7");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}const c=async e=>{var r;const s=null===(r=u(e))||void 0===r?void 0:r.signal,n=l(e.url),o=await fetch(e.url,function(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?a(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(e.batch),signal:s},n));if(429===o.status||o.status>=500&&o.status<600)throw new Error(`HTTP Error ${o.status} (${o.statusText})`);return o},u=e=>{if(e.abortController)return e.abortController;if(e.timeout){const t=new AbortController;return setTimeout((()=>{t.abort()}),e.timeout),t}},l=(0,o.default)((e=>new URL(e).origin===location.origin?{}:{mode:"cors",credentials:"include"}))})),n.register("6O0C7",(function(t,r){e(t.exports,"default",(()=>n));var s=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function i(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(i=e[r],n=t[r],!(i===n||s(i)&&s(n)))return!1;var i,n;return!0}function n(e,t){void 0===t&&(t=i);var r=null;function s(){for(var s=[],i=0;i<arguments.length;i++)s[i]=arguments[i];if(r&&r.lastThis===this&&t(s,r.lastArgs))return r.lastResult;var n=e.apply(this,s);return r={lastResult:n,lastArgs:s,lastThis:this},n}return s.clear=function(){r=null},s}})),n.register("jvRBd",(function(r,s){e(r.exports,"default",(()=>d));var i=n("bQXDl"),o=n("fWyjG"),a=n("2tSnc"),c=n("cf6o3"),u=n("doiol");const l="ajs_anonymous_id";class d{constructor(){this.store=new(0,c.default)({useStoragePrefix:!1}),this.cookie=new(0,a.default)}getUserId(){return this.userId||null}setUserId(e){this.userId=e}getAnonymousId(){const e=this.store.getItem(l);if(e){const t=(0,u.safeJSONParse)(e);return(!this.lastAnonymousIdCookieUpdate||(0,i.default)(new Date,new Date(this.lastAnonymousIdCookieUpdate))>=7)&&this.setAnonymousId(t),t}{const e=this.cookie.get(l);if(e){const t=(0,u.safeJSONParse)(e);return this.store.setItem(l,e),t}}const r=t(o)();return this.setAnonymousId(r),r}setAnonymousId(e){return this.cookie.set(l,JSON.stringify(e)),this.lastAnonymousIdCookieUpdate=Date.now(),this.store.setItem(l,JSON.stringify(e))}}})),n.register("bQXDl",(function(t,r){e(t.exports,"default",(()=>c));var s=n("2YXTi"),i=n("M2R2q"),o=n("7cu4N");function a(e,t){var r=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}function c(e,t){(0,o.default)(2,arguments);var r=(0,s.default)(e),n=(0,s.default)(t),c=a(r,n),u=Math.abs((0,i.default)(r,n));r.setDate(r.getDate()-c*u);var l=Number(a(r,n)===-c),d=c*(u-l);return 0===d?0:d}})),n.register("2YXTi",(function(t,r){e(t.exports,"default",(()=>i));var s=n("7cu4N");function i(e){(0,s.default)(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}})),n.register("7cu4N",(function(t,r){function s(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}e(t.exports,"default",(()=>s))})),n.register("M2R2q",(function(t,r){e(t.exports,"default",(()=>c));var s=n("3QdqZ"),i=n("brZ3c"),o=n("7cu4N"),a=864e5;function c(e,t){(0,o.default)(2,arguments);var r=(0,i.default)(e),n=(0,i.default)(t),c=r.getTime()-(0,s.default)(r),u=n.getTime()-(0,s.default)(n);return Math.round((c-u)/a)}})),n.register("3QdqZ",(function(t,r){function s(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}e(t.exports,"default",(()=>s))})),n.register("brZ3c",(function(t,r){e(t.exports,"default",(()=>o));var s=n("2YXTi"),i=n("7cu4N");function o(e){(0,i.default)(1,arguments);var t=(0,s.default)(e);return t.setHours(0,0,0,0),t}})),n.register("2tSnc",(function(r,s){e(r.exports,"default",(()=>h));var i=n("8ymt6"),o=n("aZhAj"),a=n("kD5ZG"),c=n("iAybV"),u=n("eysgY");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function d(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?l(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class h{constructor(){this.cookieLike=(0,u.canUseCookie)()?t(o):new(0,c.default)}set(e,t,r){return this.cookieLike.set(e,t,d(d({},a.COOKIE_OPTIONS),{},{domain:(0,u.getTld)()},r))}get(e){return this.cookieLike.get(e)}remove(e,t){this.cookieLike.remove(e,d({},t))}}})),n.register("aZhAj",(function(e,t){!function(t){if("function"==typeof define&&define.amd&&(define(t),!0),e.exports=t(),!!0){var r=window.Cookies,s=window.Cookies=t();s.noConflict=function(){return window.Cookies=r,s}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var s in r)t[s]=r[s]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(s){function i(){}function n(t,r,n){if("undefined"!=typeof document){"number"==typeof(n=e({path:"/"},i.defaults,n)).expires&&(n.expires=new Date(1*new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var o=JSON.stringify(r);/^[\{\[]/.test(o)&&(r=o)}catch(e){}r=s.write?s.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in n)n[c]&&(a+="; "+c,!0!==n[c]&&(a+="="+n[c].split(";")[0]));return document.cookie=t+"="+r+a}}function o(e,r){if("undefined"!=typeof document){for(var i={},n=document.cookie?document.cookie.split("; "):[],o=0;o<n.length;o++){var a=n[o].split("="),c=a.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=t(a[0]);if(c=(s.read||s)(c,u)||t(c),r)try{c=JSON.parse(c)}catch(e){}if(i[u]=c,e===u)break}catch(e){}}return e?i[e]:i}}return i.set=n,i.get=function(e){return o(e,!1)},i.getJSON=function(e){return o(e,!0)},i.remove=function(t,r){n(t,"",e(r,{expires:-1}))},i.defaults={},i.withConverter=r,i}((function(){}))}))})),n.register("kD5ZG",(function(t,r){e(t.exports,"COOKIE_OPTIONS",(()=>s));const s={expires:365,secure:"https:"===window.location.protocol,path:"/"}})),n.register("iAybV",(function(t,r){e(t.exports,"default",(()=>i));var s=n("cf6o3");class i{constructor(){this.safeStorage=new(0,s.default)({useStoragePrefix:!1})}set(e,t){return this.safeStorage.setItem(e,t),t}get(e){return this.safeStorage.getItem(e)||void 0}remove(e){this.safeStorage.removeItem(e)}}})),n.register("cf6o3",(function(t,r){e(t.exports,"default",(()=>o));var s=n("aNTKV"),i=n("hyGQU");class o extends i.default{constructor(e){let t;try{t=window.localStorage||s.default}catch(e){t=s.default}super(t,e)}}})),n.register("aNTKV",(function(r,s){e(r.exports,"default",(()=>o));var i=n("8ymt6");var o=new class{constructor(){t(i)(this,"_data",{}),t(i)(this,"length",0),t(i)(this,"setItem",((e,t)=>(this._data[e]=t,this.length=Object.keys(this._data).length,t))),t(i)(this,"getItem",(e=>e in this._data?this._data[e]:null)),t(i)(this,"removeItem",(e=>(e in this._data&&delete this._data[e],this.length=Object.keys(this._data).length,null))),t(i)(this,"clear",(()=>{this._data={},this.length=0})),t(i)(this,"key",(e=>Object.keys(this._data)[e]))}}})),n.register("hyGQU",(function(r,s){e(r.exports,"default",(()=>u));var i=n("8ymt6"),o=n("19ezt"),a=n("aNTKV");function c(e){const t="test_value";if(!e)return!1;try{const r="awc.storage.support";e.setItem(r,t);const s=e.getItem(r);return e.removeItem(r),s===t}catch(e){return!1}}class u{constructor(e,r={}){t(i)(this,"getStore",(()=>this._store)),t(i)(this,"getItem",(e=>this._store.getItem(this.createKey(e)))),t(i)(this,"removeItem",(e=>this._store.removeItem(this.createKey(e)))),t(i)(this,"setItem",((e,t)=>{try{this._store.setItem(this.createKey(e),t)}catch(r){(function(e){let t=!1;if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else-2147024882===e.number&&(t=!0);return t})(r)&&(this.swapToInMemory(),this._store.setItem(this.createKey(e),t))}})),t(i)(this,"swapToInMemory",(()=>{if(this._store===a.default)return;const e=Object.keys(this._store||{});let t;c(window.awcInMemoryStorageFallback)?t=window.awcInMemoryStorageFallback:(t=a.default,window.awcInMemoryStorageFallback||(window.awcInMemoryStorageFallback=a.default)),e.forEach((e=>{if(0===e.indexOf(this.getPrefix())){const r=this._store.getItem(e);r&&t.setItem(e,r)}})),this._store=t})),t(i)(this,"clear",(()=>this._store.clear())),t(i)(this,"key",(e=>this._store.key(e))),t(i)(this,"getPrefix",(()=>this._prefix)),t(i)(this,"createKey",(e=>this._prefix?`${this.getPrefix()}.${e}`:e)),this.options=r;const s=[];(void 0===r.useStoragePrefix||r.useStoragePrefix)&&s.push("awc"),r.envPrefix&&r.envPrefix!==o.envType.PROD&&s.push(r.envPrefix),this._prefix=s.join("-"),c(e)?this._store=e:this.swapToInMemory()}}})),n.register("eysgY",(function(r,s){e(r.exports,"canUseCookie",(()=>a)),e(r.exports,"getTld",(()=>l));var i=n("aZhAj"),o=n("6O0C7");const a=()=>!("file:"===location.protocol||"chrome-extension:"===location.protocol),c="__awc_tld_test__",u="tld_test",l=(0,o.default)((()=>{const{hostname:e}=location,r=e.split(".");for(let e=1;e<=r.length;e++){const s=`.${r.slice(-1*e).join(".")}`;if(t(i).set(c,u,{domain:s}),t(i).get(c)===u)return t(i).remove(c,{domain:s}),s}return e}))})),n.register("doiol",(function(r,s){e(r.exports,"buildContext",(()=>u)),e(r.exports,"prepareEventProperties",(()=>l)),e(r.exports,"safeJSONParse",(()=>p));var i=n("8ymt6"),o=n("4zrRL");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function c(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?a(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const u=e=>c(c({},e.context),{},{userAgent:navigator.userAgent}),l=e=>{const r=d(e);return t(o)(r)},d=e=>{const t={};return Object.keys(e).forEach((r=>{const s=h(e,r);void 0!==s&&(Array.isArray(s)?t[r]=s.map((e=>e)):t[r]="object"==typeof s&&null!==s?d(s):s)})),t},h=(e,t)=>e[t],p=e=>{try{return JSON.parse(e)}catch(t){return e}}})),n.register("4zrRL",(function(e,t){var r=n("7LaJL");function s(e,t){return void 0===t&&(t=!0),e&&"object"==typeof e?function(e,t){return Object.keys(e).forEach((function(r){e[r]=s(e[r],t)})),e}(e,t):Array.isArray(e)?function(e,t){return e.forEach((function(r,i){e[i]=s(r,t)})),e}(e,t):r.is(e,t)?r.parse(e):e}e.exports=s})),n.register("7LaJL",(function(t,r){var s,i;e(t.exports,"parse",(()=>s),(e=>s=e)),e(t.exports,"is",(()=>i),(e=>i=e));var n=/^(\d{4})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:([ T])(\d{2}):?(\d{2})(?::?(\d{2})(?:[,\.](\d{1,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?)?)?$/;s=function(e){var t=[1,5,6,7,11,12],r=n.exec(e),s=0;if(!r)return new Date(e);for(var i,o=0;i=t[o];o++)r[i]=parseInt(r[i],10)||0;r[2]=parseInt(r[2],10)||1,r[3]=parseInt(r[3],10)||1,r[2]--,r[8]=r[8]?(r[8]+"00").substring(0,3):0," "===r[4]?s=(new Date).getTimezoneOffset():"Z"!==r[9]&&r[10]&&(s=60*r[11]+r[12],"+"===r[10]&&(s=0-s));var a=Date.UTC(r[1],r[2],r[3],r[5],r[6]+s,r[7],r[8]);return new Date(a)},i=function(e,t){return"string"==typeof e&&((!t||!1!==/^\d{4}-\d{2}-\d{2}/.test(e))&&n.test(e))}})),n.register("Dn6LR",(function(r,s){e(r.exports,"default",(()=>c));var i=n("8ymt6"),o=n("19ezt"),a=n("g4FZb");class c{constructor(){t(i)(this,"handleOriginParameters",((e,t)=>{const r=Object.keys(e);if(!(r.length>0))throw new Error("Empty parameter mapping provided");const s=r.filter((e=>Object.values(o.originTracingType).indexOf(e)<0));if(s.length>0)throw new Error(`Invalid Origin Tracing Parameter(s) supplied: ${s.join()}!`);const i=(0,a.default)(((e,t)=>r.indexOf(t)>=0),t);return Object.keys(i).map((t=>({[t]:e[t](i[t])}))).reduce(((e,t)=>Object.assign(e,t)),{})})),this._originStore={}}}})),n.register("g4FZb",(function(t,r){e(t.exports,"defaultHistoryReplaceFn",(()=>o)),e(t.exports,"default",(()=>a));var s=n("jFnua"),i=n("fT9bc");const o=e=>window.history.replaceState({},"",e);var a=(e,t=o)=>{const r=window.location.href,n=window.location.hash,a=""!==n?r.replace(n,""):r,{url:c,query:u}=(0,s.parseUrl)(a),l=(0,i.pickBy)(u,e);if(Object.keys(l).length>0){const r=(0,i.omitBy)(u,e);if(Object.keys(r).length>0){t(`${c}?${(0,s.stringify)(r)}${n}`)}else t(`${c}${n}`)}return l}})),n.register("jFnua",(function(t,r){var s,i,o,a,c,u;e(t.exports,"extract",(()=>s),(e=>s=e)),e(t.exports,"parse",(()=>i),(e=>i=e)),e(t.exports,"stringify",(()=>o),(e=>o=e)),e(t.exports,"parseUrl",(()=>a),(e=>a=e)),e(t.exports,"stringifyUrl",(()=>c),(e=>c=e)),e(t.exports,"pick",(()=>u),(e=>u=e));var l=n("frtmH"),d=n("chRI9"),h=n("3qU8D"),p=n("5qfDQ");function f(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function m(e,t){return t.encode?t.strict?l(e):encodeURIComponent(e):e}function g(e,t){return t.decode?d(e):e}function y(e){return Array.isArray(e)?e.sort():"object"==typeof e?y(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function v(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function b(e){const t=(e=v(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function E(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function I(e,t){f((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,s)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===s[e]&&(s[e]={}),s[e][t[1]]=r):s[e]=r};case"bracket":return(e,r,s)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==s[e]?s[e]=[].concat(s[e],r):s[e]=[r]:s[e]=r};case"comma":case"separator":return(t,r,s)=>{const i="string"==typeof r&&r.includes(e.arrayFormatSeparator),n="string"==typeof r&&!i&&g(r,e).includes(e.arrayFormatSeparator);r=n?g(r,e):r;const o=i||n?r.split(e.arrayFormatSeparator).map((t=>g(t,e))):null===r?r:g(r,e);s[t]=o};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t),s=Object.create(null);if("string"!=typeof e)return s;if(!(e=e.trim().replace(/^[?#&]/,"")))return s;for(const i of e.split("&")){if(""===i)continue;let[e,n]=h(t.decode?i.replace(/\+/g," "):i,"=");n=void 0===n?null:["comma","separator"].includes(t.arrayFormat)?n:g(n,t),r(g(e,t),n,s)}for(const e of Object.keys(s)){const r=s[e];if("object"==typeof r&&null!==r)for(const e of Object.keys(r))r[e]=E(r[e],t);else s[e]=E(r,t)}return!1===t.sort?s:(!0===t.sort?Object.keys(s).sort():Object.keys(s).sort(t.sort)).reduce(((e,t)=>{const r=s[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=y(r):e[t]=r,e}),Object.create(null))}s=b,i=I,o=(e,t)=>{if(!e)return"";f((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const r=r=>t.skipNull&&null==e[r]||t.skipEmptyString&&""===e[r],s=function(e){switch(e.arrayFormat){case"index":return t=>(r,s)=>{const i=r.length;return void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?r:null===s?[...r,[m(t,e),"[",i,"]"].join("")]:[...r,[m(t,e),"[",m(i,e),"]=",m(s,e)].join("")]};case"bracket":return t=>(r,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?r:null===s?[...r,[m(t,e),"[]"].join("")]:[...r,[m(t,e),"[]=",m(s,e)].join("")];case"comma":case"separator":return t=>(r,s)=>null==s||0===s.length?r:0===r.length?[[m(t,e),"=",m(s,e)].join("")]:[[r,m(s,e)].join(e.arrayFormatSeparator)];default:return t=>(r,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?r:null===s?[...r,m(t,e)]:[...r,[m(t,e),"=",m(s,e)].join("")]}}(t),i={};for(const t of Object.keys(e))r(t)||(i[t]=e[t]);const n=Object.keys(i);return!1!==t.sort&&n.sort(t.sort),n.map((r=>{const i=e[r];return void 0===i?"":null===i?m(r,t):Array.isArray(i)?i.reduce(s(r),[]).join("&"):m(r,t)+"="+m(i,t)})).filter((e=>e.length>0)).join("&")},a=(e,t)=>{t=Object.assign({decode:!0},t);const[r,s]=h(e,"#");return Object.assign({url:r.split("?")[0]||"",query:I(b(e),t)},t&&t.parseFragmentIdentifier&&s?{fragmentIdentifier:g(s,t)}:{})},c=(e,t)=>{t=Object.assign({encode:!0,strict:!0},t);const r=v(e.url).split("?")[0]||"",n=s(e.url),a=i(n,{sort:!1}),c=Object.assign(a,e.query);let u=o(c,t);u&&(u=`?${u}`);let l=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(l=`#${m(e.fragmentIdentifier,t)}`),`${r}${u}${l}`},u=(e,t,r)=>{r=Object.assign({parseFragmentIdentifier:!0},r);const{url:s,query:i,fragmentIdentifier:n}=a(e,r);return c({url:s,query:p(i,t),fragmentIdentifier:n},r)}})),n.register("frtmH",(function(e,t){e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))})),n.register("chRI9",(function(e,t){var r="%[a-f0-9]{2}",s=new RegExp(r,"gi"),i=new RegExp("(%[a-f0-9]{2})+","gi");function n(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),s=e.slice(t);return Array.prototype.concat.call([],n(r),n(s))}function o(e){try{return decodeURIComponent(e)}catch(i){for(var t=e.match(s),r=1;r<t.length;r++)t=(e=n(t,r).join("")).match(s);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"","%FF%FE":""},r=i.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var s=o(r[0]);s!==r[0]&&(t[r[0]]=s)}r=i.exec(e)}t["%C2"]="";for(var n=Object.keys(t),a=0;a<n.length;a++){var c=n[a];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}})),n.register("3qU8D",(function(e,t){e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]}})),n.register("5qfDQ",(function(e,t){e.exports=function(e,t){for(var r={},s=Object.keys(e),i=Array.isArray(t),n=0;n<s.length;n++){var o=s[n],a=e[o];(i?-1!==t.indexOf(o):t(o,a,e))&&(r[o]=a)}return r}})),n.register("jsIfO",(function(r,s){e(r.exports,"default",(()=>l));var i=n("8ymt6"),o=n("cf6o3");const a="session.id",c="session.expiry",u=/^\d+$/;class l{constructor(e={}){t(i)(this,"_generateNewSessionId",(()=>{const e=Date.now().toString();return this._safeLocalStorage.setItem(a,e),e})),t(i)(this,"_updateSessionExpiry",(()=>{const e=Date.now()+this._sessionExpiryTime;return this._safeLocalStorage.setItem(c,e.toString()),e})),t(i)(this,"_debouncedUpdateSessionExpiry",(e=>{const{_updateSessionExpiry:t}=this;if(e<Date.now()+this._sessionExpiryDebounceThresholdPercentage*this._sessionExpiryTime)return t();this._sessionExpiryDebounceTimer&&clearTimeout(this._sessionExpiryDebounceTimer),this._sessionExpiryDebounceTimer=setTimeout((()=>{t()}),this._sessionExpiryDebounce)})),this._sessionExpiryTime=e.sessionExpiryTime||18e5,this._sessionExpiryDebounce=e.sessionExpiryDebounce||5e3,this._sessionExpiryDebounceThresholdPercentage=e.sessionExpiryDebounceThresholdPercentage||.9,this._safeLocalStorage=new(0,o.default)}getCurrentSessionId(){const e=this._safeLocalStorage.getItem(a),t=parseInt(this._safeLocalStorage.getItem(c)||"0",10)||0;return this._debouncedUpdateSessionExpiry(t),!e||t<=Date.now()||Number.isNaN(t)?this._generateNewSessionId():u.test(e)?e:this._generateNewSessionId()}}})),n.register("gTWwa",(function(t,r){e(t.exports,"default",(()=>o));var s=n("aNTKV"),i=n("hyGQU");class o extends i.default{constructor(e){let t;try{t=window.sessionStorage||s.default}catch(e){t=s.default}super(t,e)}}})),n.register("lTBkD",(function(r,s){e(r.exports,"default",(()=>u));var i=n("8ymt6"),o=n("fWyjG"),a=n("gTWwa");const c="tab.id";class u{constructor(){t(i)(this,"_generateNewTabId",(()=>{const e=t(o)();return this._safeSessionStorage.setItem(c,e),e})),this._safeSessionStorage=new(0,a.default)}getCurrentTabId(){let e=this._safeSessionStorage.getItem(c);return e||(e=this._generateNewTabId()),e}}})),n.register("7A4TJ",(function(r,s){e(r.exports,"default",(()=>y));var i=n("8ymt6"),o=n("jFnua"),a=n("fWyjG"),c=n("19ezt"),u=n("fT9bc"),l=n("gTWwa"),d=n("g4FZb");function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function p(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?h(Object(s),!0).forEach((function(r){t(i)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):h(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const f="taskSessions",m="taskSessionsInit",g="awc.";class y{constructor(){t(i)(this,"_taskSessionsNotRecentlyInitialised",(e=>null===this._safeSessionStorage.getItem(f)||null===this._safeSessionStorage.getItem(m)||parseInt(this._safeSessionStorage.getItem(m)||"0",10)<e-3e3)),t(i)(this,"_removeTaskSessionPrefix",((e,t)=>t.split(g)[1])),t(i)(this,"_isTaskSessionQueryParam",((e,t)=>t.startsWith(g))),t(i)(this,"getAllTaskSessions",(()=>{try{return JSON.parse(this._safeSessionStorage.getItem(f)||"")}catch(e){return{}}})),t(i)(this,"_writeToSessionStorage",(e=>{try{this._safeSessionStorage.setItem(f,JSON.stringify(e))}catch(e){}})),t(i)(this,"_appendTaskSessions",(e=>{const t=this.getAllTaskSessions(),r=null===t?e:Object.assign(t,e);this._writeToSessionStorage(r)})),t(i)(this,"_safelyRemoveKey",((e,t)=>null===e?{}:(delete e[t],e))),t(i)(this,"createTaskSession",(e=>{const r=t(a)(),s={};return s[e]=r,this._appendTaskSessions(s),r})),t(i)(this,"createTaskSessionWithProvidedId",((e,t)=>{if("string"!=typeof t)throw new TypeError("invalid taskSessionId, must be string");const r={};r[e]=t,this._appendTaskSessions(r)})),t(i)(this,"completeTaskSession",(e=>{const t=this.getAllTaskSessions(),r=this._safelyRemoveKey(t,e);this._writeToSessionStorage(r)})),t(i)(this,"formatTaskSessionQueryString",(({uri:e,includedTaskSessions:t})=>{const{url:r,query:s}=(0,o.parseUrl)(e),i=this.getAllTaskSessions(),n=t?(0,u.pick)(i,t):(0,u.omit)(i,Object.values(c.originTracingType));if(0===Object.keys(n).length)return e;const a=p(p({},(0,u.mapKeys)(n,((e,t)=>g+t))),s);return`${r}?${(0,o.stringify)(a)}`})),t(i)(this,"stripQueryParameters",(()=>{const e=(0,u.mapKeys)((0,d.default)(this._isTaskSessionQueryParam),this._removeTaskSessionPrefix);this._appendTaskSessions(e)}));const e=Date.now();this._safeSessionStorage=new(0,l.default);try{this._taskSessionsNotRecentlyInitialised(e)&&(this._writeToSessionStorage({}),this._safeSessionStorage.setItem(m,e.toString()))}catch(e){}}}})),n.register("lIOOf",(function(r,s){e(r.exports,"default",(()=>u));var i=n("8ymt6"),o=n("aZhAj");const a="atlassian_analytics_debug",c="synthetic";var u=class{constructor(){t(i)(this,"_bind",(()=>{window.testAnalytics||(window.testAnalytics={eventCache:[],events:()=>window.testAnalytics.eventCache,clear:()=>{window.testAnalytics.eventCache=[];try{localStorage.removeItem("awc.ui.viewed.last.sent"),localStorage.removeItem("awc-staging.ui.viewed.last.sent"),localStorage.removeItem("awc-dev.ui.viewed.last.sent"),localStorage.removeItem("awc-local.ui.viewed.last.sent")}catch(e){}}})})),t(i)(this,"_cache",(e=>{window.testAnalytics.eventCache.length>=100&&(window.testAnalytics.eventCache=window.testAnalytics.eventCache.slice(1,window.testAnalytics.eventCache.length)),window.testAnalytics.eventCache.push(e)})),t(i)(this,"_shouldCacheEvent",(()=>this._isDebugCookieEnabled)),t(i)(this,"saveEvent",(e=>{e&&this._shouldCacheEvent()&&(window.testAnalytics||this._bind(),e.tags instanceof Array?e.tags.push(c):e.tags=[c],this._cache(e))})),this._isDebugCookieEnabled=(()=>{try{return JSON.parse(t(o).get(a)||"false")}catch(e){t(o).remove(a)}return!1})(),this._isDebugCookieEnabled&&this._bind()}}})),n.register("5V0ZZ",(function(r,s){e(r.exports,"default",(()=>h));var i=n("hqAz3"),o=n("8ymt6"),a=n("19ezt"),c=n("cf6o3");const u=["embeddedProduct"];function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function d(e){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?l(Object(s),!0).forEach((function(r){t(o)(e,r,s[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}class h{constructor(e,r,s,n={}){if(t(o)(this,"start",(()=>{this._startInterval(),this._bindEventListeners()})),t(o)(this,"stop",(()=>{this._stopInterval(),this._unbindEventListeners()})),t(o)(this,"resetTimers",(()=>{this._intervalId&&(this.stop(),this.start())})),t(o)(this,"_bindEventListeners",(()=>{window.addEventListener("focus",this._focusListener),window.addEventListener("blur",this._blurListener)})),t(o)(this,"_unbindEventListeners",(()=>{window.removeEventListener("focus",this._focusListener),window.removeEventListener("blur",this._blurListener)})),t(o)(this,"_startInterval",(()=>{clearInterval(this._intervalId),this._intervalId=setInterval(this._handleInterval,this._delay)})),t(o)(this,"_stopInterval",(()=>{this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)})),t(o)(this,"_getProductKey",((e,t)=>{let r=e;return t&&(r+=`-${t}`),r})),t(o)(this,"_getLastSentTimestamp",((e,t,r)=>(((this._parseLocalStorageData()||{})[r]||{})[t]||{})[e]||null)),t(o)(this,"_parseLocalStorageData",(()=>{const e=this._safeLocalStorage.getItem(this._storageKey);try{return JSON.parse(e||"")}catch(e){return this._safeLocalStorage.removeItem(this._storageKey),null}})),t(o)(this,"_setLastSentTimestamp",((e,t,r)=>{const s=this._parseLocalStorageData()||{},i=s[r]||{},n=i[t]||{};n[e]=Date.now(),i[t]=n,s[r]=i,this._safeLocalStorage.setItem(this._storageKey,JSON.stringify(s))})),t(o)(this,"_shouldSendEvent",((e,t,r,s)=>{if(!document.hasFocus())return!1;if(t!==a.tenantType.NONE&&!r||!s)return!1;return Date.now()-this._getLastSentTimestamp(e,r,s)>this._throttle})),t(o)(this,"_handleInterval",(()=>{const e=this._getContext(),{embeddedProduct:r}=e,s=t(i)(e,u);this._sendEvent(this._product,s),r&&this._sendEvent(r,s,!0)})),t(o)(this,"_sendEvent",((e,t,r=!1)=>{const{subproduct:s,tenantIdType:i,tenantId:n,userId:o,lastScreenEvent:a,attributes:c}=t,u=this._getProductKey(e,s);if(this._shouldSendEvent(u,i,n,o)){this._setLastSentTimestamp(u,n,o);const t=this._createEvent(e,s,r,a,c);this._onEvent(t)}})),t(o)(this,"_createEvent",((e,t,r,s,i)=>{const n={product:e,source:"ui",action:"viewed",actionSubject:"ui",attributes:i};return r&&(n.subproduct=null,n.version=null,n.attributes=d(d({},n.attributes),{},{embeddedInEnv:this._productInfo.env,embeddedInProduct:this._productInfo.product,embeddedInSubproduct:t,embeddedInVersion:this._productInfo.version,embeddedInOrigin:this._productInfo.origin,embeddedInPlatform:this._productInfo.platform})),s&&(n.attributes=d(d({},n.attributes),{},{lastScreenEvent:{name:s.name,attributes:s.attributes}})),n})),!e)throw new Error("Missing productInfo");if(!e.product)throw new Error("Missing productInfo.product");if(!r)throw new Error("Missing getContext callback");if("function"!=typeof r)throw new Error("Invalid getContext, must be function");if(!s)throw new Error("Missing onEvent callback");if("function"!=typeof s)throw new Error("Invalid onEvent, must be function");this._productInfo=e,this._product=e.product,this._getContext=r,this._onEvent=s,this._delay=n.delay||2e3,this._throttle=n.throttle||36e5,this._storageKey=n.storageKey||"ui.viewed.last.sent",this._safeLocalStorage=new(0,c.default)({envPrefix:this._productInfo.env}),this._focusListener=()=>{this._startInterval()},this._blurListener=()=>{this._stopInterval()}}}})),n.register("iRYxa",(function(t,r){function s(e,t){return e&&"function"==typeof e?()=>{e(t)}:null}e(t.exports,"default",(()=>s))}));
//# sourceMappingURL=settings.8628830b.js.map
